webpackJsonp([11],{1202:function(e,t,o){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function a(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function i(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var l=o(111),u=n(l),s=function(){function e(e,t){for(var o=0;o<t.length;o++){var n=t[o];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,o,n){return o&&e(t.prototype,o),n&&e(t,n),t}}(),c=o(2),d=n(c),f=o(65),p=o(85),h=o(131),_=n(h),m=o(564),y=n(m),b=o(1273),O=n(b),A=function(e){function t(e){r(this,t);var o=a(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return o.state={slData:{author:{}}},o.handleTitleValueChange=o.handleTitleValueChange.bind(o),o.handleAuthorValueChange=o.handleAuthorValueChange.bind(o),o.addAuthor=o.addAuthor.bind(o),o.addBook=o.addBook.bind(o),o}return i(t,e),s(t,[{key:"addBook",value:function(e){var t=this;_.default.addBook(e).then(function(e){t.props.sendNotification("添加成功"),t.props.resetForm("addBook")},function(e){t.props.sendNotification(e.message,"error",0)})}},{key:"addAuthor",value:function(e){var t=this;_.default.addAuthor(e).then(function(e){t.props.sendNotification("添加成功");var o=e.json.ops[0]._id,n=e.json.ops[0].name;t.props.initializeForm("addBook",{authors:[{name:n,value:o}],author:""}),t.props.closeModal()},function(e){t.props.sendNotification(e.message,"error")})}},{key:"handleAuthorValueChange",value:function(e){(0,u.default)(e)||this.props.fetchAuthors({q:e})}},{key:"handleTitleValueChange",value:function(e){(0,u.default)(e)||this.props.searchDoubanBooks(e)}},{key:"render",value:function(){return d.default.createElement(y.default,{title:"添加书籍"},d.default.createElement("h1",{className:"page-title"},"添加书籍"),d.default.createElement(O.default,{onTitleInputChange:this.handleTitleValueChange,onAuthorInputChange:this.handleAuthorValueChange,onSaveAuthor:this.addAuthor,onSaveBook:this.addBook}))}}]),t}(c.Component),g=function(e){return{notification:e.components.notification,elements:e.elements}},v=(0,f.connect)(g,{sendNotification:p.sendNotification,openModal:p.openModal,searchDoubanBooks:p.searchDoubanBooks,closeModal:p.closeModal,fetchAuthors:p.fetchAuthors,resetForm:p.resetForm,initializeForm:p.initializeForm})(A);t.default=v;!function(){"undefined"!=typeof __REACT_HOT_LOADER__&&(__REACT_HOT_LOADER__.register(A,"AddBook","/Users/liang/Projects/readr/src/isomorphic/routes/AddBook/AddBook.tsx"),__REACT_HOT_LOADER__.register(g,"mapStateToProps","/Users/liang/Projects/readr/src/isomorphic/routes/AddBook/AddBook.tsx"),__REACT_HOT_LOADER__.register(v,"default","/Users/liang/Projects/readr/src/isomorphic/routes/AddBook/AddBook.tsx"))}()},1240:function(e,t,o){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function a(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function i(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var l=function(){function e(e,t){for(var o=0;o<t.length;o++){var n=t[o];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,o,n){return o&&e(t.prototype,o),n&&e(t,n),t}}(),u=o(2),s=n(u),c=o(284),d=n(c),f=function(e){function t(e){r(this,t);var o=a(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return o.state={value:null},o.handleFileChange=o.handleFileChange.bind(o),o}return i(t,e),l(t,[{key:"handleFileChange",value:function(e){var t=this.props,o=t.url,n=t.onComplete,r=t.onSuccess,a=t.onError,i=e.target.files,l=new FormData;i.length>1?d.default.each(i,function(e,t){l.append(e,t)}):l.append("file",i[0]),d.default.ajax({url:o,type:"POST",data:l,cache:!1,processData:!1,contentType:!1,xhrFields:{withCredentials:!0},complete:function(e){n&&n(e)},success:function(e,t,o){r&&r(e)},error:function(e,t,o){a&&a(e.responseJSON)}})}},{key:"componentDidMount",value:function(){}},{key:"render",value:function(){var e=this,t=this.props,o=t.url,n=t.accept,r=t.noAjax,a=t.children,i=t.name,l=t.multiple,u=t.style;return s.default.createElement("div",{className:"file-trigger",onClick:function(t){r||(0,d.default)(e.fileInput).click()},style:Object.assign({display:"inline-block"},u)},s.default.createElement("form",{action:o,method:"post",encType:"multipart/form-data",style:r?{}:{display:"none"}},s.default.createElement("input",{multiple:l,type:"file",name:i||"file",id:"upload-file",value:r?void 0:"",ref:function(t){e.fileInput=t},onChange:function(t){r||e.handleFileChange(t)},accept:n||".*"}),s.default.createElement("input",{type:"submit",value:"提交"})),a)}}]),t}(u.Component),p=f;t.default=p;!function(){"undefined"!=typeof __REACT_HOT_LOADER__&&(__REACT_HOT_LOADER__.register(f,"FileUploader","/Users/liang/Projects/readr/src/isomorphic/elements/FileUploader/FileUploader.tsx"),__REACT_HOT_LOADER__.register(p,"default","/Users/liang/Projects/readr/src/isomorphic/elements/FileUploader/FileUploader.tsx"))}()},1241:function(e,t,o){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var r=o(1240),a=n(r),i=a.default;t.default=i;!function(){"undefined"!=typeof __REACT_HOT_LOADER__&&__REACT_HOT_LOADER__.register(i,"default","/Users/liang/Projects/readr/src/isomorphic/elements/FileUploader/index.ts")}()},1272:function(e,t,o){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function a(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function i(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var l=function(){function e(e,t){for(var o=0;o<t.length;o++){var n=t[o];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,o,n){return o&&e(t.prototype,o),n&&e(t,n),t}}(),u="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},s=o(2),c=n(s),d=o(65),f=o(176),p=n(f),h=o(85),_=o(569),m=n(_),y=o(565),b=n(y),O=function(e,t,o,n){var r,a=arguments.length,i=a<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,o):n;if("object"===("undefined"==typeof Reflect?"undefined":u(Reflect))&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,o,n);else for(var l=e.length-1;l>=0;l--)(r=e[l])&&(i=(a<3?r(i):a>3?r(t,o,i):r(t,o))||i);return a>3&&i&&Object.defineProperty(t,o,i),i},A=function(e){function t(e){return r(this,t),a(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e))}return i(t,e),l(t,[{key:"render",value:function(){var e=this.props,t=e.fields,o=t.name,n=t.slug,r=t.description,a=e.handleSubmit,i=e.closeModal,l=e.onSave;return c.default.createElement("div",null,c.default.createElement(m.default,Object.assign({placeholder:"名字"},o)),c.default.createElement(m.default,Object.assign({placeholder:"唯一标识"},n)),c.default.createElement(m.default,Object.assign({placeholder:"描述"},r)),c.default.createElement(b.default,{onConfirm:a(function(e){l(e)}),onCancel:i}))}}]),t}(s.Component);A=O([(0,p.default)({form:"addAuthor",fields:["name","slug","description"]})],A);var g=(0,d.connect)(function(e){return e},{sendNotification:h.sendNotification,closeModal:h.closeModal})(A);t.default=g;!function(){"undefined"!=typeof __REACT_HOT_LOADER__&&(__REACT_HOT_LOADER__.register(O,"__decorate","/Users/liang/Projects/readr/src/isomorphic/routes/AddBook/components/AddAuthorForm.tsx"),__REACT_HOT_LOADER__.register(A,"AddAuthorForm","/Users/liang/Projects/readr/src/isomorphic/routes/AddBook/components/AddAuthorForm.tsx"),__REACT_HOT_LOADER__.register(g,"default","/Users/liang/Projects/readr/src/isomorphic/routes/AddBook/components/AddAuthorForm.tsx"))}()},1273:function(e,t,o){"use strict";function n(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o]);return t.default=e,t}function r(e){return e&&e.__esModule?e:{default:e}}function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function l(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var u=o(285),s=r(u),c=o(87),d=r(c),f=o(111),p=r(f),h=function(){function e(e,t){for(var o=0;o<t.length;o++){var n=t[o];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,o,n){return o&&e(t.prototype,o),n&&e(t,n),t}}(),_="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},m=o(2),y=r(m),b=o(65),O=o(176),A=r(O),g=o(85),v=o(175),E=n(v),k=o(563),T=o(1272),j=r(T),C=o(1241),R=r(C),w=function(e,t,o,n){var r,a=arguments.length,i=a<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,o):n;if("object"===("undefined"==typeof Reflect?"undefined":_(Reflect))&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,o,n);else for(var l=e.length-1;l>=0;l--)(r=e[l])&&(i=(a<3?r(i):a>3?r(t,o,i):r(t,o))||i);return a>3&&i&&Object.defineProperty(t,o,i),i},P=function(e){function t(e){a(this,t);var o=i(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return o.handleTitleOptionClick=o.handleTitleOptionClick.bind(o),o.handleAddNewAuthor=o.handleAddNewAuthor.bind(o),o}return l(t,e),h(t,[{key:"handleTitleOptionClick",value:function(e){var t={cover:e.additional.cover,description:e.additional.description,author:e.additional.author};this.props.initializeForm("addBook",t),this.setState({slAuthor:{value:e.additional.author,values:[]}})}},{key:"handleAddNewAuthor",value:function(e){this.props.openModal({title:"添加作者",content:y.default.createElement(j.default,{onSave:this.props.onSaveAuthor})}),this.props.initializeForm("addAuthor",{name:e})}},{key:"render",value:function(){var e=this,t=this.props,o=t.fields,n=o.title,r=o.author,a=o.authors,i=o.cover,l=o.description,u=o.file,c=t.handleSubmit,f=t.onTitleInputChange,h=t.onAuthorInputChange,_=t.doubanBooksAsOptions,m=t.authorsAsOptions,b=t.onSaveBook,O=a.get([]).map(function(e){return e.value}),A=m.filter(function(e){return O.indexOf(e.value)===-1});return y.default.createElement("div",null,y.default.createElement(k.SelectizeInput,{placeholder:"书名",value:n.value,values:[],options:_,onInputChange:function(e){f(e),n.set(e)},useValue:!0,onOptionClick:this.handleTitleOptionClick}),y.default.createElement(k.SelectizeInput,{placeholder:"作者",value:r.get(),values:a.get([]),options:A,onInputChange:function(e){h(e),r.set(e)},onValuesChange:a.onChange,onAddNewValue:this.handleAddNewAuthor}),y.default.createElement(k.Input,Object.assign({placeholder:"封面图片地址"},i)),y.default.createElement(k.Textarea,Object.assign({placeholder:"描述"},l)),(0,p.default)(u.value)?y.default.createElement("div",null,y.default.createElement(R.default,{url:"/api/books",accept:".txt,.epub",name:"book-file",onSuccess:function(e){u.set(e)},onError:function(t){e.props.sendNotification(t.message,"error")}},y.default.createElement(k.Button,{color:"white"},"选择书籍")),y.default.createElement("p",null,"支持 txt 和 epub 格式")):y.default.createElement("div",null,y.default.createElement("span",null,u.value.originalname," "),y.default.createElement(k.Button,{color:"white",onClick:function(){u.set({})}},"重新选择")),y.default.createElement(k.Button,{onClick:c(function(e){var t=(0,d.default)(e,["author"]);t.authors=(0,s.default)(t.authors,"value"),t.file=e.file._id,b(t)})},"添加"))}}]),t}(m.Component);P=w([(0,A.default)({form:"addBook",fields:["title","author","authors","cover","description","file"],destroyOnUnmount:!0})],P);var B=function(e,t){return{routing:e.routing.locationBeforeTransitions,doubanBooksAsOptions:E.doubanBooksAsOptions("search")(e),authorsAsOptions:E.authorsAsOptions("search")(e)}},F=(0,b.connect)(B,{sendNotification:g.sendNotification,openModal:g.openModal,initializeForm:g.initializeForm})(P);t.default=F;!function(){"undefined"!=typeof __REACT_HOT_LOADER__&&(__REACT_HOT_LOADER__.register(w,"__decorate","/Users/liang/Projects/readr/src/isomorphic/routes/AddBook/components/AddBookForm.tsx"),__REACT_HOT_LOADER__.register(P,"AddBookForm","/Users/liang/Projects/readr/src/isomorphic/routes/AddBook/components/AddBookForm.tsx"),__REACT_HOT_LOADER__.register(B,"mapStateToProps","/Users/liang/Projects/readr/src/isomorphic/routes/AddBook/components/AddBookForm.tsx"),__REACT_HOT_LOADER__.register(F,"default","/Users/liang/Projects/readr/src/isomorphic/routes/AddBook/components/AddBookForm.tsx"))}()}});