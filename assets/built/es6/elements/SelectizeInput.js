import React, { Component } from 'react';
import Icon from 'elements/Icon';
class SelectizeInput extends Component {
    constructor(props) {
        super(props);
        this.state = {
            showOptions: false,
            focus: false,
            value: '',
            expendedOptionIndex: 0
        };
    }
    clearState(callback) {
        this.setState({
            showOptions: false,
            value: '',
            expendedOptionIndex: 0
        }, () => {
            if (callback) {
                callback();
            }
        });
    }
    addValue(index) {
        this.clearState(() => {
            this.props.onValuesChange(index, 'ADD');
        });
    }
    removeValue(index) {
        this.clearState(() => {
            this.props.onValuesChange(index, 'REMOVE');
        });
    }
    handleKeyPress(e) {
        if (e.keyCode === 8 && !this.state.value) {
            this.removeValue(this.props.values.length - 1);
        }
        if (e.keyCode === 13 && this.state.showOptions) {
            e.preventDefault();
            this.addValue(0);
        }
    }
    getFocus() {
        let input = document.querySelector(this.refs.input);
        input.focus();
    }
    expendOption(index) {
        this.setState({
            expendedOptionIndex: index
        });
    }
    componentWillReceiveProps(nextProps) {
        if (this.state.value !== '') {
            this.setState({
                showOptions: true
            });
        }
    }
    render() {
        let value = this.state.value;
        let values = this.props.values;
        let options = this.props.options ? this.props.options : [];
        let onChange = this.props.onChange ? this.props.onChange : null;
        let initialInputWidth = this.props.initialInputWidth ? this.props.initialInputWidth : '100%';
        let inputWidth = values.length > 0 ? (value.length === 0 ? 16 : value.length * 16) : initialInputWidth;
        let placeholder = values.length > 0 ? '' : this.props.placeholder;
        let className = 'selectize-input' + (this.props.className ? ` ${this.props.className}` : '') + (this.state.focus === true ? ' focus' : '') + (values.length === 0 ? ' empty' : '');
        let addNewValue = this.props.addNewValue ? this.props.addNewValue : undefined;
        return (React.createElement("div", {onClick: this.getFocus.bind(this), className: className}, values.map((value, index) => {
            return (React.createElement("span", {key: index, className: "tag"}, value, React.createElement(Icon, {size: "small", name: "close-light", onClick: this.removeValue.bind(this, index)})));
        }), React.createElement("input", {style: { width: inputWidth }, ref: "input", value: value, placeholder: placeholder, onKeyDown: this.handleKeyPress.bind(this), onBlur: () => {
            this.setState({ focus: false });
        }, onFocus: () => {
            this.setState({ focus: true });
        }, onChange: event => {
            this.setState({
                value: event.target.value
            });
            onChange(event);
        }}), this.state.showOptions && this.state.value !== '' ? (React.createElement("ul", {className: "query-results"}, options.map((option, index) => {
            if (typeof option === 'string') {
                return React.createElement("li", {onClick: this.addValue.bind(this, index), key: index}, option);
            }
            else if (typeof option === 'object') {
                let showMoreInfo = true;
                return (React.createElement("li", {onMouseOver: () => {
                    this.expendOption(index);
                }, onClick: this.addValue.bind(this, index), key: index}, option.thumb && this.state.expendedOptionIndex === index ? (React.createElement("div", {className: "thumb"}, React.createElement("img", {src: option.thumb}))) : null, React.createElement("h3", null, option.value), option.subInfo && this.state.expendedOptionIndex === index ? (React.createElement("p", null, option.subInfo)) : null));
            }
        }), options.length === 0 && addNewValue ? (React.createElement("li", {onClick: addNewValue, className: "add"}, "Add ", this.state.value)) : null)) : null));
    }
}
export default SelectizeInput;

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImVsZW1lbnRzL1NlbGVjdGl6ZUlucHV0LnRzeCJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiT0FBTyxLQUFLLEVBQUUsRUFBRSxTQUFTLEVBQWEsTUFBTSxPQUFPO09BQzVDLElBQUksTUFBTSxlQUFlO0FBcUJoQyw2QkFBNkIsU0FBUztJQU9wQyxZQUFZLEtBQUs7UUFDZixNQUFNLEtBQUssQ0FBQyxDQUFBO1FBQ1osSUFBSSxDQUFDLEtBQUssR0FBRztZQUNYLFdBQVcsRUFBRSxLQUFLO1lBQ2xCLEtBQUssRUFBRSxLQUFLO1lBQ1osS0FBSyxFQUFFLEVBQUU7WUFDVCxtQkFBbUIsRUFBRSxDQUFDO1NBQ3ZCLENBQUE7SUFDSCxDQUFDO0lBRUQsVUFBVSxDQUFDLFFBQVE7UUFDakIsSUFBSSxDQUFDLFFBQVEsQ0FBQztZQUNaLFdBQVcsRUFBRSxLQUFLO1lBQ2xCLEtBQUssRUFBRSxFQUFFO1lBQ1QsbUJBQW1CLEVBQUUsQ0FBQztTQUN2QixFQUFFO1lBQ0QsRUFBRSxDQUFBLENBQUMsUUFBUSxDQUFDLENBQUMsQ0FBQztnQkFDWixRQUFRLEVBQUUsQ0FBQTtZQUNaLENBQUM7UUFDSCxDQUFDLENBQUMsQ0FBQTtJQUNKLENBQUM7SUFFRCxRQUFRLENBQUMsS0FBSztRQUNaLElBQUksQ0FBQyxVQUFVLENBQUM7WUFDZCxJQUFJLENBQUMsS0FBSyxDQUFDLGNBQWMsQ0FBQyxLQUFLLEVBQUUsS0FBSyxDQUFDLENBQUE7UUFDekMsQ0FBQyxDQUFDLENBQUE7SUFDSixDQUFDO0lBRUQsV0FBVyxDQUFDLEtBQUs7UUFDZixJQUFJLENBQUMsVUFBVSxDQUFDO1lBQ2QsSUFBSSxDQUFDLEtBQUssQ0FBQyxjQUFjLENBQUMsS0FBSyxFQUFFLFFBQVEsQ0FBQyxDQUFBO1FBQzVDLENBQUMsQ0FBQyxDQUFBO0lBQ0osQ0FBQztJQUVELGNBQWMsQ0FBQyxDQUFDO1FBQ2QsRUFBRSxDQUFBLENBQUMsQ0FBQyxDQUFDLE9BQU8sS0FBSyxDQUFDLElBQUksQ0FBQyxJQUFJ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Q0FBQyxNQUFNLEtBQUssQ0FBQyxJQUFJLFdBQVcsR0FBRyxDQUNwQyxxQkFBQyxFQUFFLElBQUMsT0FBTyxFQUFFLFdBQVksRUFBQyxTQUFTLEVBQUMsS0FBSyxXQUFNLElBQUksQ0FBQyxLQUFLLENBQUMsS0FBTSxDQUFLLENBQ3RFLEdBQUMsSUFDSCxDQUNFLENBQ04sR0FBQyxJQUNILENBQ0csQ0FDUCxDQUFBO0lBQ0gsQ0FBQztBQUNILENBQUM7QUFFRCxlQUFlLGNBQWMsQ0FBQSIsImZpbGUiOiJlbGVtZW50cy9TZWxlY3RpemVJbnB1dC5qcyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCBSZWFjdCwgeyBDb21wb25lbnQsIFByb3BUeXBlcyB9IGZyb20gJ3JlYWN0J1xuaW1wb3J0IEljb24gZnJvbSAnZWxlbWVudHMvSWNvbidcblxuXG5pbnRlcmZhY2UgUHJvcHMge1xuICBjbGFzc05hbWU/OiBzdHJpbmdcbiAgcGxhY2Vob2xkZXI/OiBzdHJpbmdcbiAgb25DaGFuZ2U/OiBhbnlcbiAgdmFsdWVzOiBBcnJheTxzdHJpbmc+XG4gIFxuICAvLyBvcHRpb25zIGNhbiBiZSBhbiBwbGFpbiBhcnJheSBvciBhbiBhcnJheSBvZiBvYmplY3Qge3ZhbHVlLCBzdWJJbmZvLCB0aHVtYn0gcHJvdmlkaW5nIG1vcmUgaW5mb1xuICBvcHRpb25zPzogQXJyYXk8YW55PlxuICBcbiAgLy8gdGFrZXMgdHdvIHBhcmFtZXRlcnM6IHRhcmdldEluZGV4LCB0eXBlOiBBZGQsIFJFTU9WRVxuICBvblZhbHVlc0NoYW5nZT86ICh0YXJnZXRJbmRleDpudW1iZXIsIHR5cGU6c3RyaW5nKSA9PiB2b2lkXG4gIFxuICBpbml0aWFsSW5wdXRXaWR0aD86IG51bWJlclxuICBcbiAgLy8gYWRkIG5ldyB2YWx1ZSB3aGVuIHNlYXJjaCBkb2Vzbid0IG1hdGNoIGFueXRoaW5nXG4gIGFkZE5ld1ZhbHVlPzogYW55XG59XG5cbmNsYXNzIFNlbGVjdGl6ZUlucHV0IGV4dGVuZHMgQ29tcG9uZW50PFByb3BzLCBhbnk+IHtcbiAgXG4gIHJlZnM6IHtcbiAgICBbc3RyaW5nOiBzdHJpbmddOiBhbnlcbiAgICBpbnB1dDogc3RyaW5nXG4gIH1cbiAgXG4gIGNvbnN0cnVjdG9yKHByb3BzKSB7XG4gICAgc3VwZXIocHJvcHMpXG4gICAgdGhpcy5zdGF0ZSA9IHtcbiAgICAgIHNob3dPcHRpb25zOiBmYWxzZSxcbiAgICAgIGZvY3VzOiBmYWxzZSxcbiAgICAgIHZhbHVlOiAnJyxcbiAgICAgIGV4cGVuZGVkT3B0aW9uSW5kZXg6IDBcbiAgICB9XG4gIH1cblxuICBjbGVhclN0YXRlKGNhbGxiYWNrKSB7XG4gICAgdGhpcy5zZXRTdGF0ZSh7XG4gICAgICBzaG93T3B0aW9uczogZmFsc2UsXG4gICAgICB2YWx1ZTogJycsXG4gICAgICBleHBlbmRlZE9wdGlvbkluZGV4OiAwXG4gICAgfSwgKCkgPT4ge1xuICAgICAgaWYoY2FsbGJhY2spIHtcbiAgICAgICAgY2FsbGJhY2soKVxuICAgICAgfVxuICAgIH0pXG4gIH1cblxuICBhZGRWYWx1ZShpbmRleCkge1xuICAgIHRoaXMuY2xlYXJTdGF0ZSgoKSA9PiB7XG4gICAgICB0aGlzLnByb3BzLm9uVmFsdWVzQ2hhbmdlKGluZGV4LCAnQUREJylcbiAgICB9KVxuICB9XG5cbiAgcmVtb3ZlVmFsdWUoaW5kZXgpIHtcbiAgICB0aGlzLmNsZWFyU3RhdGUoKCkgPT4ge1xuICAgICAgdGhpcy5wcm9wcy5vblZhbHVlc0NoYW5nZShpbmRleCwgJ1JFTU9WRScpXG4gICAgfSlcbiAgfVxuXG4gIGhhbmRsZUtleVByZXNzKGUpIHtcbiAgICBpZihlLmtleUNvZGUgPT09IDggJiYgIXRoaXMuc3RhdGUudmFsdWUpIHtcbiAgICAgIHRoaXMucmVtb3ZlVmFsdWUodGhpcy5wcm9wcy52YWx1ZXMubGVuZ3RoIC0xKVxuICAgIH1cbiAgICBpZihlLmtleUNvZGUgPT09IDEzICYmIHRoaXMuc3RhdGUuc2hvd09wdGlvbnMpIHtcbiAgICAgIGUucHJldmVudERlZmF1bHQoKVxuICAgICAgdGhpcy5hZGRWYWx1ZSgwKVxuICAgIH1cbiAgfVxuXG4gIGdldEZvY3VzKCkge1xuICAgIGxldCBpbnB1dCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IodGhpcy5yZWZzLmlucHV0KSBhcyBIVE1MSW5wdXRFbGVtZW50XG4gICAgaW5wdXQuZm9jdXMoKVxuICB9XG5cbiAgZXhwZW5kT3B0aW9uKGluZGV4KSB7XG4gICAgdGhpcy5zZXRTdGF0ZSh7XG4gICAgICBleHBlbmRlZE9wdGlvbkluZGV4OiBpbmRleFxuICAgIH0pXG4gIH1cblxuICBjb21wb25lbnRXaWxsUmVjZWl2ZVByb3BzKG5leHRQcm9wcykge1xuICAgIGlmKHRoaXMuc3RhdGUudmFsdWUgIT09ICcnKSB7XG4gICAgICB0aGlzLnNldFN0YXRlKHtcbiAgICAgICAgc2hvd09wdGlvbnM6IHRydWVcbiAgICAgIH0pXG4gICAgfVxuICB9XG5cbiAgcmVuZGVyKCl7XG4gICAgbGV0IHZhbHVlID0gdGhpcy5zdGF0ZS52YWx1ZVxuICAgIGxldCB2YWx1ZXMgPSB0aGlzLnByb3BzLnZhbHVlc1xuICAgIGxldCBvcHRpb25zID0gdGhpcy5wcm9wcy5vcHRpb25zP3RoaXMucHJvcHMub3B0aW9uczpbXVxuICAgIGxldCBvbkNoYW5nZSA9IHRoaXMucHJvcHMub25DaGFuZ2U/dGhpcy5wcm9wcy5vbkNoYW5nZTpudWxsXG4gICAgbGV0IGluaXRpYWxJbnB1dFdpZHRoID0gdGhpcy5wcm9wcy5pbml0aWFsSW5wdXRXaWR0aD90aGlzLnByb3BzLmluaXRpYWxJbnB1dFdpZHRoOicxMDAlJ1xuICAgIGxldCBpbnB1dFdpZHRoID0gdmFsdWVzLmxlbmd0aCA+IDA/KHZhbHVlLmxlbmd0aCA9PT0gMD8xNjp2YWx1ZS5sZW5ndGggKiAxNik6aW5pdGlhbElucHV0V2lkdGhcbiAgICBsZXQgcGxhY2Vob2xkZXIgPSB2YWx1ZXMubGVuZ3RoID4gMD8nJzp0aGlzLnByb3BzLnBsYWNlaG9sZGVyXG4gICAgbGV0IGNsYXNzTmFtZSA9ICdzZWxlY3RpemUtaW5wdXQnICsgKHRoaXMucHJvcHMuY2xhc3NOYW1lP2AgJHt0aGlzLnByb3BzLmNsYXNzTmFtZX1gOicnKSArICh0aGlzLnN0YXRlLmZvY3VzID09PSB0cnVlPycgZm9jdXMnOicnKSArICh2YWx1ZXMubGVuZ3RoID09PSAwPycgZW1wdHknOicnKVxuICAgIGxldCBhZGROZXdWYWx1ZSA9IHRoaXMucHJvcHMuYWRkTmV3VmFsdWU/dGhpcy5wcm9wcy5hZGROZXdWYWx1ZTp1bmRlZmluZWRcblxuICAgIHJldHVybiAoXG4gICAgICA8ZGl2IG9uQ2xpY2s9e3RoaXMuZ2V0Rm9jdXMuYmluZCh0aGlzKX0gY2xhc3NOYW1lPXtjbGFzc05hbWV9PlxuICAgICAgICB7XG4gICAgICAgICAgdmFsdWVzLm1hcCgodmFsdWUsIGluZGV4KSA9PiB7XG4gICAgICAgICAgICByZXR1cm4gKFxuICAgICAgICAgICAgICA8c3BhbiBrZXk9e2luZGV4fSBjbGFzc05hbWU9XCJ0YWdcIj5cbiAgICAgICAgICAgICAgICB7dmFsdWV9XG4gICAgICAgICAgICAgICAgPEljb25cbiAgICAgICAgICAgICAgICAgIHNpemU9e1wic21hbGxcIn1cbiAgICAgICAgICAgICAgICAgIG5hbWU9XCJjbG9zZS1saWdodFwiXG4gICAgICAgICAgICAgICAgICBvbkNsaWNrPXt0aGlzLnJlbW92ZVZhbHVlLmJpbmQodGhpcywgaW5kZXgpfVxuICAgICAgICAgICAgICAgIC8+XG4gICAgICAgICAgICAgIDwvc3Bhbj5cbiAgICAgICAgICAgIClcbiAgICAgICAgICB9KVxuICAgICAgICB9XG4gICAgICAgIDxpbnB1dFxuICAgICAgICAgIHN0eWxlPXt7d2lkdGg6IGlucHV0V2lkdGh9fVxuICAgICAgICAgIHJlZj1cImlucHV0XCJcbiAgICAgICAgICB2YWx1ZT17dmFsdWV9XG4gICAgICAgICAgcGxhY2Vob2xkZXI9e3BsYWNlaG9sZGVyfVxuICAgICAgICAgIG9uS2V5RG93bj17dGhpcy5oYW5kbGVLZXlQcmVzcy5iaW5kKHRoaXMpfVxuICAgICAgICAgIG9uQmx1cj17KCkgPT4ge1xuICAgICAgICAgICAgdGhpcy5zZXRTdGF0ZSh7IGZvY3VzOiBmYWxzZSB9KVxuICAgICAgICAgIH19XG4gICAgICAgICAgb25Gb2N1cz17KCkgPT4ge1xuICAgICAgICAgICAgdGhpcy5zZXRTdGF0ZSh7IGZvY3VzOiB0cnVlIH0pXG4gICAgICAgICAgfX1cbiAgICAgICAgICBvbkNoYW5nZT17ZXZlbnQgPT4ge1xuICAgICAgICAgICAgdGhpcy5zZXRTdGF0ZSh7XG4gICAgICAgICAgICAgIHZhbHVlOiAoZXZlbnQudGFyZ2V0IGFzIEhUTUxJbnB1dEVsZW1lbnQpLnZhbHVlXG4gICAgICAgICAgICB9KVxuICAgICAgICAgICAgb25DaGFuZ2UoZXZlbnQpXG4gICAgICAgICAgfX1cbiAgICAgICAgLz5cbiAgICAgICAge1xuICAgICAgICAgIHRoaXMuc3RhdGUuc2hvd09wdGlvbnMgJiYgdGhpcy5zdGF0ZS52YWx1ZSAhPT0gJycgPyhcbiAgICAgICAgICAgIDx1bCBjbGFzc05hbWU9XCJxdWVyeS1yZXN1bHRzXCI+XG4gICAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICBvcHRpb25zLm1hcCgob3B0aW9uLCBpbmRleCkgPT4ge1xuICAgICAgICAgICAgICAgICAgaWYodHlwZW9mIG9wdGlvbiA9PT0gJ3N0cmluZycpIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIDxsaSBvbkNsaWNrPXt0aGlzLmFkZFZhbHVlLmJpbmQodGhpcywgaW5kZXgpfSBrZXk9e2luZGV4fT57b3B0aW9ufTwvbGk+XG4gICAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKHR5cGVvZiBvcHRpb24gPT09ICdvYmplY3QnKSB7XG4gICAgICAgICAgICAgICAgICAgIGxldCBzaG93TW9yZUluZm8gPSB0cnVlXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiAoXG4gICAgICAgICAgICAgICAgICAgIDxsaVxuICAgICAgICAgICAgICAgICAgICAgIG9uTW91c2VPdmVyPXsoKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmV4cGVuZE9wdGlvbihpbmRleClcbiAgICAgICAgICAgICAgICAgICAgICB9fVxuICAgICAgICAgICAgICAgICAgICAgIG9uQ2xpY2s9e3RoaXMuYWRkVmFsdWUuYmluZCh0aGlzLCBpbmRleCl9XG4gICAgICAgICAgICAgICAgICAgICAga2V5PXtpbmRleH1cbiAgICAgICAgICAgICAgICAgICAgPlxuICAgICAgICAgICAgICAgICAgICAgIHtvcHRpb24udGh1bWIgJiYgdGhpcy5zdGF0ZS5leHBlbmRlZE9wdGlvbkluZGV4ID09PSBpbmRleCA/KFxuICAgICAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzc05hbWU9XCJ0aHVtYlwiPjxpbWcgc3JjPXtvcHRpb24udGh1bWJ9IC8+PC9kaXY+XG4gICAgICAgICAgICAgICAgICAgICAgKTpudWxsfVxuICAgICAgICAgICAgICAgICAgICAgIDxoMz57b3B0aW9uLnZhbHVlfTwvaDM+XG4gICAgICAgICAgICAgICAgICAgICAge29wdGlvbi5zdWJJbmZvICYmIHRoaXMuc3RhdGUuZXhwZW5kZWRPcHRpb25JbmRleCA9PT0gaW5kZXggPyhcbiAgICAgICAgICAgICAgICAgICAgICAgIDxwPntvcHRpb24uc3ViSW5mb308L3A+XG4gICAgICAgICAgICAgICAgICAgICAgKTpudWxsfVxuICAgICAgICAgICAgICAgICAgICA8L2xpPlxuICAgICAgICAgICAgICAgICAgICApXG4gICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgb3B0aW9ucy5sZW5ndGggPT09IDAgJiYgYWRkTmV3VmFsdWUgPyAoXG4gICAgICAgICAgICAgICAgICA8bGkgb25DbGljaz17YWRkTmV3VmFsdWV9IGNsYXNzTmFtZT1cImFkZFwiPkFkZCB7dGhpcy5zdGF0ZS52YWx1ZX08L2xpPlxuICAgICAgICAgICAgICAgICk6bnVsbFxuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICA8L3VsPlxuICAgICAgICAgICk6bnVsbFxuICAgICAgICB9XG4gICAgICA8L2Rpdj5cbiAgICApXG4gIH1cbn1cblxuZXhwb3J0IGRlZmF1bHQgU2VsZWN0aXplSW5wdXRcbiJdLCJzb3VyY2VSb290IjoiL3NvdXJjZS8ifQ==
