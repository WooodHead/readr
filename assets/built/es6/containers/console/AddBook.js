import React, { Component } from 'react';
import ReactDOM from 'react-dom';
import { connect } from 'react-redux';
import { fetchDoubanBookSearchResults, handleNotification } from 'actions/index';
import Input from 'elements/Input';
import Button from 'elements/Button';
import SelectizeInput from 'elements/SelectizeInput';
import Modal from 'elements/Modal';
import _ from 'lodash';
import apis from 'utils/apis';
class AddBook extends Component {
    constructor(props) {
        super(props);
        this.defaultState = {
            dbBookQuery: "",
            bookTitle: [],
            bookAuthor: [],
            bookCover: '',
            bookDescription: '',
            bookContent: '',
            authorResults: [],
            isAddAuthorModalVisible: false
        };
        this.state = Object.assign({}, this.defaultState);
        this.fetchDoubanBookSearchResults = _.debounce(this.props.fetchDoubanBookSearchResults, 150);
    }
    addBook(e) {
        e.preventDefault();
        const data = {
            title: this.state.bookTitle.length !== 0 ? this.state.bookTitle[0].title : '',
            description: this.state.bookDescription,
            content: this.state.bookContent,
            author: JSON.stringify(this.state.bookAuthor.map(a => a.id)),
            cover: this.state.bookCover
        };
        console.log(data);
        apis.addBook(data).then(result => {
            this.props.handleNotification('添加成功');
            this.setState(this.defaultState);
        }, error => {
            this.props.handleNotification(error.message);
        });
    }
    addAuthor(e) {
        e.preventDefault();
        const data = {
            name: this.state.authorName,
            description: this.state.authorDescription,
            slug: this.state.authorSlug
        };
        apis.addAuthor(data).then(result => {
            this.props.handleNotification('添加成功');
            this.setState({
                bookAuthor: [...this.state.bookAuthor, { name: this.state.authorName, id: result.id }],
                isAddAuthorModalVisible: false
            });
            this.refs.bookAuthor.clearState();
        }, error => {
            this.props.handleNotification(error.message);
        });
    }
    search(e) {
        let query = e.target.value;
        this.setState({
            dbBookQuery: query
        });
        if (query !== '') {
            this.fetchDoubanBookSearchResults(query);
        }
    }
    searchAuthors(e) {
        let query = e.target.value;
        if (query !== '') {
            apis.searchAuthors(query).then(response => {
                this.setState({
                    authorResults: response
                });
            });
        }
    }
    render() {
        let book = null;
        let searchResultIds = this.props.doubanBookSearchResults[this.state.dbBookQuery] ?
            this.props.doubanBookSearchResults[this.state.dbBookQuery].ids : [];
        let doubanBooks = this.props.doubanBooks;
        let searchResults = searchResultIds.map(id => doubanBooks[id]);
        return (React.createElement("form", null, React.createElement(Modal, {width: 600, isVisible: this.state.isAddAuthorModalVisible, onRequestClose: () => {
            this.setState({
                isAddAuthorModalVisible: false
            });
        }}, React.createElement("h1", {className: "page-title", style: { marginTop: 0 }}, "Add author"), React.createElement(Input, {onChange: event => {
            this.setState({
                authorName: event.target.value
            });
        }, value: this.state.authorName, placeholder: "Name"}), React.createElement(Input, {onChange: event => {
            this.setState({
                authorSlug: event.target.value
            });
        }, value: this.state.authorSlug, placeholder: "Slug"}), React.createElement("textarea", {placeholder: "Description", style: { height: 100 }, value: this.state.authorDescription, onChange: event => {
            this.setState({
                authorDescription: event.target.value
            });
        }}), React.createElement(Button, {onClick: this.addAuthor.bind(this)}, "Add")), React.createElement("h1", {className: "page-title"}, "Add Book"), React.createElement(SelectizeInput, {ref: "bookTitle", onChange: this.search.bind(this), onValuesChange: (targetIndex, type) => {
            switch (type) {
                case 'ADD':
                    this.setState({
                        bookTitle: [...this.state.bookTitle, searchResults[targetIndex]],
                        bookCover: searchResults[targetIndex].image,
                        bookDescription: searchResults[targetIndex].summary
                    });
                    break;
                case 'REMOVE':
                    this.setState({
                        bookTitle: this.state.bookTitle.filter((value, index) => (targetIndex !== index ? true : false))
                    });
                    break;
                default:
                    console.error('Undefined type');
            }
        }, options: searchResults.map(a => ({
            value: a.title,
            subInfo: a.author,
            thumb: a.image
        })), values: this.state.bookTitle.map(book => book.title), placeholder: "Book title", addNewValue: () => {
            let value = ReactDOM.findDOMNode(this.refs.bookTitle).querySelector('input').value;
            this.setState({
                bookTitle: [...this.state.bookTitle, { title: value }]
            });
            this.refs.bookTitle.clearState();
        }}), React.createElement(SelectizeInput, {ref: "bookAuthor", onChange: this.searchAuthors.bind(this), onValuesChange: (targetIndex, type) => {
            switch (type) {
                case 'ADD':
                    this.setState({
                        bookAuthor: [...this.state.bookAuthor, this.state.authorResults[targetIndex]]
                    });
                    break;
                case 'REMOVE':
                    this.setState({
                        bookAuthor: this.state.bookAuthor.filter((value, index) => (targetIndex !== index ? true : false))
                    });
                    break;
                default:
                    console.error('Undefined type');
            }
        }, options: this.state.authorResults.map(a => a.name), values: this.state.bookAuthor.map(a => a.name), placeholder: "Author", addNewValue: () => {
            let name = this.refs.bookAuthor.state.value;
            this.setState({
                isAddAuthorModalVisible: true,
                authorName: name
            });
        }}), React.createElement(Input, {onChange: event => {
            this.setState({
                bookCover: event.target.value
            });
        }, value: this.state.bookCover, placeholder: "Cover"}), React.createElement("textarea", {placeholder: "Description", style: { height: 100 }, value: this.state.bookDescription, onChange: event => {
            this.setState({
                bookDescription: event.target.value
            });
        }}), React.createElement("textarea", {placeholder: "Paste book content here", style: { height: 100 }, value: this.state.bookContent, onChange: event => {
            this.setState({
                bookContent: event.target.value
            });
        }}), React.createElement(Button, {onClick: this.addBook.bind(this)}, "Add")));
    }
}
export default connect(state => ({
    doubanBookSearchResults: state.pagination.doubanBookSearchResults,
    doubanBooks: state.entities.doubanBooks,
    notification: state.components.notification
}), { fetchDoubanBookSearchResults, handleNotification })(AddBook);

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImNvbnRhaW5lcnMvY29uc29sZS9BZGRCb29rLnRzeCJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiT0FBTyxLQUFLLEVBQUUsRUFBRSxTQUFTLEVBQUUsTUFBTSxPQUFPO09BQ2pDLFFBQVEsTUFBTSxXQUFXO09BQ3pCLEVBQUUsT0FBTyxFQUFFLE1BQU0sYUFBYTtPQUc5QixFQUFFLDRCQUE0QixFQUFFLGtCQUFrQixFQUFDLE1BQU0sZUFBZTtPQUd4RSxLQUFLLE1BQU0sZ0JBQWdCO09BQzNCLE1BQU0sTUFBTSxpQkFBaUI7T0FDN0IsY0FBYyxNQUFNLHlCQUF5QjtPQUM3QyxLQUFLLE1BQU0sZ0JBQWdCO09BQzNCLENBQUMsTUFBTSxRQUFRO09BQ2YsSUFBSSxNQUFNLFlBQVk7QUFFN0Isc0JBQXNCLFNBQVM7SUFVN0IsWUFBWSxLQUFLO1FBQ2YsTUFBTSxLQUFLLENBQUMsQ0FBQTtRQUNaLElBQUksQ0FBQyxZQUFZLEdBQUc7WUFDbEIsV0FBVyxFQUFFLEVBQUU7WUFDZixTQUFTLEVBQUUsRUFBRTtZQUNiLFVBQVUsRUFBRSxFQUFFO1lBQ2QsU0FBUyxFQUFFLEVBQUU7WUFDYixlQUFlLEVBQUUsRUFBRTtZQUNuQixXQUFXLEVBQUUsRUFBRTtZQUNmLGFBQWEsRUFBRSxFQUFFO1lBQ2pCLHVCQUF1QixFQUFFLEtBQUs7U0FDL0IsQ0FBQTtRQUNELElBQUksQ0FBQyxLQUFLLEdBQUcsTUFBTSxDQUFDLE1BQU0sQ0FBQyxFQUFFLEVBQUUsSUFBSSxDQUFDLFlBQVksQ0FBQyxDQUFBO1FBQ2pELElBQUksQ0FBQyw0QkFBNEIsR0FBRyxDQUFDLENBQUMsUUFBUSxDQUFDLElBQUksQ0FBQyxLQUFLLENBQUMsNEJBQTRCLEVBQUUsR0FBRyxDQUFDLENBQUE7SUFDOUYsQ0FBQztJQUVELE9BQU8sQ0FBQyxDQUFDO1FBQ1AsQ0FBQyxDQUFDLGNBQWMsRUFBRSxDQUFBO1FBQ2xCLE1BQU0sSUFBSSxHQUFHO1lBQ1gsS0FBSyxFQUFFLElBQUksQ0FBQyxLQUFLLENB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QUNILENBQUM7QUFFRCxlQUFlLE9BQU8sQ0FDcEIsS0FBSyxJQUFJLENBQUM7SUFDUix1QkFBdUIsRUFBRSxLQUFLLENBQUMsVUFBVSxDQUFDLHVCQUF1QjtJQUNqRSxXQUFXLEVBQUUsS0FBSyxDQUFDLFFBQVEsQ0FBQyxXQUFXO0lBQ3ZDLFlBQVksRUFBRSxLQUFLLENBQUMsVUFBVSxDQUFDLFlBQVk7Q0FDNUMsQ0FBQyxFQUNGLEVBQUMsNEJBQTRCLEVBQUUsa0JBQWtCLEVBQVEsQ0FDMUQsQ0FBQyxPQUFPLENBQUMsQ0FBQSIsImZpbGUiOiJjb250YWluZXJzL2NvbnNvbGUvQWRkQm9vay5qcyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCBSZWFjdCwgeyBDb21wb25lbnQgfSBmcm9tICdyZWFjdCdcbmltcG9ydCBSZWFjdERPTSBmcm9tICdyZWFjdC1kb20nXG5pbXBvcnQgeyBjb25uZWN0IH0gZnJvbSAncmVhY3QtcmVkdXgnXG5pbXBvcnQgeyBMaW5rIH0gZnJvbSAncmVhY3Qtcm91dGVyJ1xuaW1wb3J0IEFwaVJvb3RzIGZyb20gJ2NvbnN0YW50cy9BcGlSb290cydcbmltcG9ydCB7IGZldGNoRG91YmFuQm9va1NlYXJjaFJlc3VsdHMsIGhhbmRsZU5vdGlmaWNhdGlvbn0gZnJvbSAnYWN0aW9ucy9pbmRleCdcbmltcG9ydCBjYWxsQXBpIGZyb20gJ3V0aWxzL2NhbGxBcGknXG5pbXBvcnQgTm90aWZpY2F0aW9uIGZyb20gJ2NvbXBvbmVudHMvTm90aWZpY2F0aW9uJ1xuaW1wb3J0IElucHV0IGZyb20gJ2VsZW1lbnRzL0lucHV0J1xuaW1wb3J0IEJ1dHRvbiBmcm9tICdlbGVtZW50cy9CdXR0b24nXG5pbXBvcnQgU2VsZWN0aXplSW5wdXQgZnJvbSAnZWxlbWVudHMvU2VsZWN0aXplSW5wdXQnXG5pbXBvcnQgTW9kYWwgZnJvbSAnZWxlbWVudHMvTW9kYWwnXG5pbXBvcnQgXyBmcm9tICdsb2Rhc2gnXG5pbXBvcnQgYXBpcyBmcm9tICd1dGlscy9hcGlzJ1xuXG5jbGFzcyBBZGRCb29rIGV4dGVuZHMgQ29tcG9uZW50PGFueSwgYW55PiB7XG4gIFxuICBkZWZhdWx0U3RhdGU6IHt9XG4gIGZldGNoRG91YmFuQm9va1NlYXJjaFJlc3VsdHM6IChzdHJpbmcpID0+IHZvaWRcbiAgcmVmczoge1xuICAgIFtzdHJpbmc6IHN0cmluZ106IGFueVxuICAgIGJvb2tBdXRob3I6IGFueVxuICAgIGJvb2tUaXRsZTogYW55XG4gIH1cbiAgXG4gIGNvbnN0cnVjdG9yKHByb3BzKSB7XG4gICAgc3VwZXIocHJvcHMpXG4gICAgdGhpcy5kZWZhdWx0U3RhdGUgPSB7XG4gICAgICBkYkJvb2tRdWVyeTogXCJcIixcbiAgICAgIGJvb2tUaXRsZTogW10sXG4gICAgICBib29rQXV0aG9yOiBbXSxcbiAgICAgIGJvb2tDb3ZlcjogJycsXG4gICAgICBib29rRGVzY3JpcHRpb246ICcnLFxuICAgICAgYm9va0NvbnRlbnQ6ICcnLFxuICAgICAgYXV0aG9yUmVzdWx0czogW10sXG4gICAgICBpc0FkZEF1dGhvck1vZGFsVmlzaWJsZTogZmFsc2VcbiAgICB9XG4gICAgdGhpcy5zdGF0ZSA9IE9iamVjdC5hc3NpZ24oe30sIHRoaXMuZGVmYXVsdFN0YXRlKVxuICAgIHRoaXMuZmV0Y2hEb3ViYW5Cb29rU2VhcmNoUmVzdWx0cyA9IF8uZGVib3VuY2UodGhpcy5wcm9wcy5mZXRjaERvdWJhbkJvb2tTZWFyY2hSZXN1bHRzLCAxNTApXG4gIH1cblxuICBhZGRCb29rKGUpIHtcbiAgICBlLnByZXZlbnREZWZhdWx0KClcbiAgICBjb25zdCBkYXRhID0ge1xuICAgICAgdGl0bGU6IHRoaXMuc3RhdGUuYm9va1RpdGxlLmxlbmd0aCAhPT0gMD90aGlzLnN0YXRlLmJvb2tUaXRsZVswXS50aXRsZTonJyxcbiAgICAgIGRlc2NyaXB0aW9uOiB0aGlzLnN0YXRlLmJvb2tEZXNjcmlwdGlvbixcbiAgICAgIGNvbnRlbnQ6IHRoaXMuc3RhdGUuYm9va0NvbnRlbnQsXG4gICAgICBhdXRob3I6IEpTT04uc3RyaW5naWZ5KHRoaXMuc3RhdGUuYm9va0F1dGhvci5tYXAoYSA9PiBhLmlkKSksXG4gICAgICBjb3ZlcjogdGhpcy5zdGF0ZS5ib29rQ292ZXJcbiAgICB9XG4gICAgY29uc29sZS5sb2coZGF0YSk7XG4gICAgYXBpcy5hZGRCb29rKGRhdGEpLnRoZW4ocmVzdWx0ID0+IHtcbiAgICAgIHRoaXMucHJvcHMuaGFuZGxlTm90aWZpY2F0aW9uKCfmt7vliqDmiJDlip8nKVxuICAgICAgdGhpcy5zZXRTdGF0ZSh0aGlzLmRlZmF1bHRTdGF0ZSlcbiAgICB9LCBlcnJvciA9PiB7XG4gICAgICB0aGlzLnByb3BzLmhhbmRsZU5vdGlmaWNhdGlvbihlcnJvci5tZXNzYWdlKVxuICAgIH0pXG4gIH1cblxuICBhZGRBdXRob3IoZSkge1xuICAgIGUucHJldmVudERlZmF1bHQoKVxuICAgIGNvbnN0IGRhdGEgPSB7XG4gICAgICBuYW1lOiB0aGlzLnN0YXRlLmF1dGhvck5hbWUsXG4gICAgICBkZXNjcmlwdGlvbjogdGhpcy5zdGF0ZS5hdXRob3JEZXNjcmlwdGlvbixcbiAgICAgIHNsdWc6IHRoaXMuc3RhdGUuYXV0aG9yU2x1Z1xuICAgIH1cbiAgICBhcGlzLmFkZEF1dGhvcihkYXRhKS50aGVuKHJlc3VsdCA9PiB7XG4gICAgICB0aGlzLnByb3BzLmhhbmRsZU5vdGlmaWNhdGlvbign5re75Yqg5oiQ5YqfJylcbiAgICAgIHRoaXMuc2V0U3RhdGUoe1xuICAgICAgICBib29rQXV0aG9yOiBbLi4udGhpcy5zdGF0ZS5ib29rQXV0aG9yLCB7IG5hbWU6IHRoaXMuc3RhdGUuYXV0aG9yTmFtZSwgaWQ6IHJlc3VsdC5pZCB9XSxcbiAgICAgICAgaXNBZGRBdXRob3JNb2RhbFZpc2libGU6IGZhbHNlXG4gICAgICB9KVxuICAgICAgdGhpcy5yZWZzLmJvb2tBdXRob3IuY2xlYXJTdGF0ZSgpXG4gICAgfSwgZXJyb3IgPT4ge1xuICAgICAgdGhpcy5wcm9wcy5oYW5kbGVOb3RpZmljYXRpb24oZXJyb3IubWVzc2FnZSlcbiAgICB9KVxuICB9XG5cbiAgc2VhcmNoKGUpIHtcbiAgICBsZXQgcXVlcnkgPSBlLnRhcmdldC52YWx1ZVxuXG4gICAgdGhpcy5zZXRTdGF0ZSh7XG4gICAgICBkYkJvb2tRdWVyeTogcXVlcnlcbiAgICB9KVxuICAgIGlmKHF1ZXJ5ICE9PSAnJykge1xuICAgICAgdGhpcy5mZXRjaERvdWJhbkJvb2tTZWFyY2hSZXN1bHRzKHF1ZXJ5KVxuICAgIH1cbiAgfVxuXG4gIHNlYXJjaEF1dGhvcnMoZSkge1xuICAgIGxldCBxdWVyeSA9IGUudGFyZ2V0LnZhbHVlXG5cbiAgICBpZihxdWVyeSAhPT0gJycpIHtcbiAgICAgIGFwaXMuc2VhcmNoQXV0aG9ycyhxdWVyeSkudGhlbihyZXNwb25zZSA9PiB7XG4gICAgICAgIHRoaXMuc2V0U3RhdGUoe1xuICAgICAgICAgIGF1dGhvclJlc3VsdHM6IHJlc3BvbnNlXG4gICAgICAgIH0pXG4gICAgICB9KVxuICAgIH1cbiAgfVxuXG4gIHJlbmRlcigpIHtcbiAgICBsZXQgYm9vayA9IG51bGxcbiAgICBsZXQgc2VhcmNoUmVzdWx0SWRzID0gdGhpcy5wcm9wcy5kb3ViYW5Cb29rU2VhcmNoUmVzdWx0c1t0aGlzLnN0YXRlLmRiQm9va1F1ZXJ5XSA/XG4gICAgICB0aGlzLnByb3BzLmRvdWJhbkJvb2tTZWFyY2hSZXN1bHRzW3RoaXMuc3RhdGUuZGJCb29rUXVlcnldLmlkcyA6IFtdXG4gICAgbGV0IGRvdWJhbkJvb2tzID0gdGhpcy5wcm9wcy5kb3ViYW5Cb29rc1xuICAgIGxldCBzZWFyY2hSZXN1bHRzID0gc2VhcmNoUmVzdWx0SWRzLm1hcChpZCA9PiBkb3ViYW5Cb29rc1tpZF0pXG5cbiAgICByZXR1cm4gKFxuICAgICAgPGZvcm0+XG4gICAgICAgIDxNb2RhbFxuICAgICAgICAgIHdpZHRoPXs2MDB9XG4gICAgICAgICAgaXNWaXNpYmxlPXt0aGlzLnN0YXRlLmlzQWRkQXV0aG9yTW9kYWxWaXNpYmxlfVxuICAgICAgICAgIG9uUmVxdWVzdENsb3NlPXsoKSA9PiB7XG4gICAgICAgICAgICB0aGlzLnNldFN0YXRlKHtcbiAgICAgICAgICAgICAgaXNBZGRBdXRob3JNb2RhbFZpc2libGU6IGZhbHNlXG4gICAgICAgICAgICB9KVxuICAgICAgICAgIH19XG4gICAgICAgID5cbiAgICAgICAgICA8aDEgY2xhc3NOYW1lPVwicGFnZS10aXRsZVwiIHN0eWxlPXt7bWFyZ2luVG9wOiAwfX0+QWRkIGF1dGhvcjwvaDE+XG4gICAgICAgICAgPElucHV0XG4gICAgICAgICAgICBvbkNoYW5nZT17ZXZlbnQgPT4ge1xuICAgICAgICAgICAgICB0aGlzLnNldFN0YXRlKHtcbiAgICAgICAgICAgICAgICBhdXRob3JOYW1lOiBldmVudC50YXJnZXQudmFsdWVcbiAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgIH19XG4gICAgICAgICAgICB2YWx1ZT17dGhpcy5zdGF0ZS5hdXRob3JOYW1lfVxuICAgICAgICAgICAgcGxhY2Vob2xkZXI9XCJOYW1lXCJcbiAgICAgICAgICAvPlxuICAgICAgICAgIDxJbnB1dFxuICAgICAgICAgICAgb25DaGFuZ2U9e2V2ZW50ID0+IHtcbiAgICAgICAgICAgICAgdGhpcy5zZXRTdGF0ZSh7XG4gICAgICAgICAgICAgICAgYXV0aG9yU2x1ZzogZXZlbnQudGFyZ2V0LnZhbHVlXG4gICAgICAgICAgICAgIH0pXG4gICAgICAgICAgICB9fVxuICAgICAgICAgICAgdmFsdWU9e3RoaXMuc3RhdGUuYXV0aG9yU2x1Z31cbiAgICAgICAgICAgIHBsYWNlaG9sZGVyPVwiU2x1Z1wiXG4gICAgICAgICAgLz5cbiAgICAgICAgICA8dGV4dGFyZWFcbiAgICAgICAgICAgIHBsYWNlaG9sZGVyPVwiRGVzY3JpcHRpb25cIlxuICAgICAgICAgICAgc3R5bGU9e3toZWlnaHQ6IDEwMH19XG4gICAgICAgICAgICB2YWx1ZT17dGhpcy5zdGF0ZS5hdXRob3JEZXNjcmlwdGlvbn1cbiAgICAgICAgICAgIG9uQ2hhbmdlPXtldmVudCA9PiB7XG4gICAgICAgICAgICAgIHRoaXMuc2V0U3RhdGUoe1xuICAgICAgICAgICAgICAgIGF1dGhvckRlc2NyaXB0aW9uOiAoZXZlbnQudGFyZ2V0IGFzIEhUTUxUZXh0QXJlYUVsZW1lbnQpLnZhbHVlXG4gICAgICAgICAgICAgIH0pXG4gICAgICAgICAgICB9fVxuICAgICAgICAgIC8+XG4gICAgICAgICAgPEJ1dHRvbiBvbkNsaWNrPXt0aGlzLmFkZEF1dGhvci5iaW5kKHRoaXMpfT5BZGQ8L0J1dHRvbj5cbiAgICAgICAgPC9Nb2RhbD5cblxuICAgICAgICA8aDEgY2xhc3NOYW1lPVwicGFnZS10aXRsZVwiPkFkZCBCb29rPC9oMT5cbiAgICAgICAgPFNlbGVjdGl6ZUlucHV0XG4gICAgICAgICAgcmVmPVwiYm9va1RpdGxlXCJcbiAgICAgICAgICBvbkNoYW5nZT17dGhpcy5zZWFyY2guYmluZCh0aGlzKX1cbiAgICAgICAgICBvblZhbHVlc0NoYW5nZT17KHRhcmdldEluZGV4LCB0eXBlKSA9PiB7XG4gICAgICAgICAgICBzd2l0Y2ggKHR5cGUpIHtcbiAgICAgICAgICAgICAgY2FzZSAnQUREJzpcbiAgICAgICAgICAgICAgICB0aGlzLnNldFN0YXRlKHtcbiAgICAgICAgICAgICAgICAgIGJvb2tUaXRsZTogWy4uLnRoaXMuc3RhdGUuYm9va1RpdGxlLCBzZWFyY2hSZXN1bHRzW3RhcmdldEluZGV4XV0sXG4gICAgICAgICAgICAgICAgICBib29rQ292ZXI6IHNlYXJjaFJlc3VsdHNbdGFyZ2V0SW5kZXhdLmltYWdlLFxuICAgICAgICAgICAgICAgICAgYm9va0Rlc2NyaXB0aW9uOiBzZWFyY2hSZXN1bHRzW3RhcmdldEluZGV4XS5zdW1tYXJ5XG4gICAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgICAgYnJlYWtcblxuICAgICAgICAgICAgICBjYXNlICdSRU1PVkUnOlxuICAgICAgICAgICAgICAgIHRoaXMuc2V0U3RhdGUoe1xuICAgICAgICAgICAgICAgICAgYm9va1RpdGxlOiB0aGlzLnN0YXRlLmJvb2tUaXRsZS5maWx0ZXIoKHZhbHVlLCBpbmRleCkgPT4gKHRhcmdldEluZGV4ICE9PSBpbmRleD90cnVlOmZhbHNlKSlcbiAgICAgICAgICAgICAgICB9KVxuICAgICAgICAgICAgICBicmVha1xuXG4gICAgICAgICAgICAgIGRlZmF1bHQ6XG4gICAgICAgICAgICAgICAgY29uc29sZS5lcnJvcignVW5kZWZpbmVkIHR5cGUnKVxuICAgICAgICAgICAgfVxuICAgICAgICAgIH19XG4gICAgICAgICAgb3B0aW9ucz17c2VhcmNoUmVzdWx0cy5tYXAoYSA9PiAoe1xuICAgICAgICAgICAgdmFsdWU6IGEudGl0bGUsXG4gICAgICAgICAgICBzdWJJbmZvOiBhLmF1dGhvcixcbiAgICAgICAgICAgIHRodW1iOiBhLmltYWdlXG4gICAgICAgICAgfSkpfVxuICAgICAgICAgIHZhbHVlcz17dGhpcy5zdGF0ZS5ib29rVGl0bGUubWFwKGJvb2sgPT4gYm9vay50aXRsZSl9XG4gICAgICAgICAgcGxhY2Vob2xkZXI9XCJCb29rIHRpdGxlXCJcbiAgICAgICAgICBhZGROZXdWYWx1ZT17KCkgPT4ge1xuICAgICAgICAgICAgbGV0IHZhbHVlID0gKFJlYWN0RE9NLmZpbmRET01Ob2RlKHRoaXMucmVmcy5ib29rVGl0bGUpLnF1ZXJ5U2VsZWN0b3IoJ2lucHV0JykgYXMgSFRNTElucHV0RWxlbWVudCkudmFsdWVcbiAgICAgICAgICAgIHRoaXMuc2V0U3RhdGUoe1xuICAgICAgICAgICAgICBib29rVGl0bGU6IFsuLi50aGlzLnN0YXRlLmJvb2tUaXRsZSwge3RpdGxlOiB2YWx1ZX1dXG4gICAgICAgICAgICB9KVxuICAgICAgICAgICAgdGhpcy5yZWZzLmJvb2tUaXRsZS5jbGVhclN0YXRlKClcbiAgICAgICAgICB9fVxuICAgICAgICAvPlxuXG4gICAgICAgIDxTZWxlY3RpemVJbnB1dFxuICAgICAgICAgIHJlZj1cImJvb2tBdXRob3JcIlxuICAgICAgICAgIG9uQ2hhbmdlPXt0aGlzLnNlYXJjaEF1dGhvcnMuYmluZCh0aGlzKX1cbiAgICAgICAgICBvblZhbHVlc0NoYW5nZT17KHRhcmdldEluZGV4LCB0eXBlKSA9PiB7XG4gICAgICAgICAgICBzd2l0Y2ggKHR5cGUpIHtcbiAgICAgICAgICAgICAgY2FzZSAnQUREJzpcbiAgICAgICAgICAgICAgICB0aGlzLnNldFN0YXRlKHtcbiAgICAgICAgICAgICAgICAgIGJvb2tBdXRob3I6IFsuLi50aGlzLnN0YXRlLmJvb2tBdXRob3IsIHRoaXMuc3RhdGUuYXV0aG9yUmVzdWx0c1t0YXJnZXRJbmRleF1dXG4gICAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgICAgYnJlYWtcblxuICAgICAgICAgICAgICBjYXNlICdSRU1PVkUnOlxuICAgICAgICAgICAgICAgIHRoaXMuc2V0U3RhdGUoe1xuICAgICAgICAgICAgICAgICAgYm9va0F1dGhvcjogdGhpcy5zdGF0ZS5ib29rQXV0aG9yLmZpbHRlcigodmFsdWUsIGluZGV4KSA9PiAodGFyZ2V0SW5kZXggIT09IGluZGV4P3RydWU6ZmFsc2UpKVxuICAgICAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAgIGJyZWFrXG5cbiAgICAgICAgICAgICAgZGVmYXVsdDpcbiAgICAgICAgICAgICAgICBjb25zb2xlLmVycm9yKCdVbmRlZmluZWQgdHlwZScpXG4gICAgICAgICAgICB9XG4gICAgICAgICAgfX1cbiAgICAgICAgICBvcHRpb25zPXt0aGlzLnN0YXRlLmF1dGhvclJlc3VsdHMubWFwKGEgPT4gYS5uYW1lKX1cbiAgICAgICAgICB2YWx1ZXM9e3RoaXMuc3RhdGUuYm9va0F1dGhvci5tYXAoYSA9PiBhLm5hbWUpfVxuICAgICAgICAgIHBsYWNlaG9sZGVyPVwiQXV0aG9yXCJcbiAgICAgICAgICBhZGROZXdWYWx1ZT17KCkgPT4ge1xuICAgICAgICAgICAgbGV0IG5hbWUgPSB0aGlzLnJlZnMuYm9va0F1dGhvci5zdGF0ZS52YWx1ZVxuXG4gICAgICAgICAgICB0aGlzLnNldFN0YXRlKHtcbiAgICAgICAgICAgICAgaXNBZGRBdXRob3JNb2RhbFZpc2libGU6IHRydWUsXG4gICAgICAgICAgICAgIGF1dGhvck5hbWU6IG5hbWVcbiAgICAgICAgICAgIH0pXG4gICAgICAgICAgfX1cbiAgICAgICAgLz5cblxuICAgICAgICA8SW5wdXRcbiAgICAgICAgICBvbkNoYW5nZT17ZXZlbnQgPT4ge1xuICAgICAgICAgICAgdGhpcy5zZXRTdGF0ZSh7XG4gICAgICAgICAgICAgIGJvb2tDb3ZlcjogZXZlbnQudGFyZ2V0LnZhbHVlXG4gICAgICAgICAgICB9KVxuICAgICAgICAgIH19XG4gICAgICAgICAgdmFsdWU9e3RoaXMuc3RhdGUuYm9va0NvdmVyfVxuICAgICAgICAgIHBsYWNlaG9sZGVyPVwiQ292ZXJcIlxuICAgICAgICAvPlxuXG4gICAgICAgIDx0ZXh0YXJlYVxuICAgICAgICAgIHBsYWNlaG9sZGVyPVwiRGVzY3JpcHRpb25cIlxuICAgICAgICAgIHN0eWxlPXt7aGVpZ2h0OiAxMDB9fVxuICAgICAgICAgIHZhbHVlPXt0aGlzLnN0YXRlLmJvb2tEZXNjcmlwdGlvbn1cbiAgICAgICAgICBvbkNoYW5nZT17ZXZlbnQgPT4ge1xuICAgICAgICAgICAgdGhpcy5zZXRTdGF0ZSh7XG4gICAgICAgICAgICAgIGJvb2tEZXNjcmlwdGlvbjogKGV2ZW50LnRhcmdldCBhcyBIVE1MVGV4dEFyZWFFbGVtZW50KS52YWx1ZVxuICAgICAgICAgICAgfSlcbiAgICAgICAgICB9fVxuICAgICAgICAvPlxuXG4gICAgICAgIDx0ZXh0YXJlYVxuICAgICAgICAgIHBsYWNlaG9sZGVyPVwiUGFzdGUgYm9vayBjb250ZW50IGhlcmVcIlxuICAgICAgICAgIHN0eWxlPXt7aGVpZ2h0OiAxMDB9fVxuICAgICAgICAgIHZhbHVlPXt0aGlzLnN0YXRlLmJvb2tDb250ZW50fVxuICAgICAgICAgIG9uQ2hhbmdlPXtldmVudCA9PiB7XG4gICAgICAgICAgICB0aGlzLnNldFN0YXRlKHtcbiAgICAgICAgICAgICAgYm9va0NvbnRlbnQ6IChldmVudC50YXJnZXQgYXMgSFRNTFRleHRBcmVhRWxlbWVudCkudmFsdWVcbiAgICAgICAgICAgIH0pXG4gICAgICAgICAgfX1cbiAgICAgICAgLz5cblxuICAgICAgICA8QnV0dG9uIG9uQ2xpY2s9e3RoaXMuYWRkQm9vay5iaW5kKHRoaXMpfT5BZGQ8L0J1dHRvbj5cbiAgICAgIDwvZm9ybT5cbiAgICApXG4gIH1cbn1cblxuZXhwb3J0IGRlZmF1bHQgY29ubmVjdChcbiAgc3RhdGUgPT4gKHtcbiAgICBkb3ViYW5Cb29rU2VhcmNoUmVzdWx0czogc3RhdGUucGFnaW5hdGlvbi5kb3ViYW5Cb29rU2VhcmNoUmVzdWx0cyxcbiAgICBkb3ViYW5Cb29rczogc3RhdGUuZW50aXRpZXMuZG91YmFuQm9va3MsXG4gICAgbm90aWZpY2F0aW9uOiBzdGF0ZS5jb21wb25lbnRzLm5vdGlmaWNhdGlvblxuICB9KSxcbiAge2ZldGNoRG91YmFuQm9va1NlYXJjaFJlc3VsdHMsIGhhbmRsZU5vdGlmaWNhdGlvbn0gYXMgYW55XG4pKEFkZEJvb2spXG4iXSwic291cmNlUm9vdCI6Ii9zb3VyY2UvIn0=
