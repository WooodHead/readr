export function filterPages(config) {
    let { startPage, quantity, offset, pages } = config;
    let newPages = [];
    while (startPage - offset < 0) {
        offset--;
    }
    startPage = startPage - offset;
    for (let i = startPage; i < quantity + startPage && i < pages.length; i++) {
        let page = pages[i];
        newPages.push(page);
    }
    return newPages;
}
export function htmlToPages(html, nodeHeights, view) {
    let pageHeight = view.pageHeight;
    let nodes = parseHTML(html);
    let pages = groupNodesByPage(nodes, nodeHeights, pageHeight);
    return {
        type: 'pages',
        props: {
            children: pages,
            view
        }
    };
}
export function pagesToHtml(pages) {
    let nodes = pages.props.children.reduce((a, b) => (a.concat(b.props.children)), []);
    let uniqueNodes = [];
    let realIndex = 0;
    // remove duplicate nodes
    for (var i = 0; i < nodes.length; i++) {
        nodes[i];
        if (nodes[i].props.index === realIndex) {
            uniqueNodes.push(nodes[i]);
            realIndex++;
        }
    }
    let html = parseNodes(uniqueNodes);
    return html;
}
export function getNodeHeights(nodes) {
    let nodesHeight = [];
    Array.prototype.forEach.call(nodes, (node, index) => {
        if (node.tagName.toLowerCase() !== "p") {
            console.error("Unsupported content found!");
        }
        nodesHeight.push(node.clientHeight);
    });
    return nodesHeight;
}
export function percentageToPage(p, pageSum) {
    if (p > 1) {
        console.error("Wrong parameter!");
        return null;
    }
    else {
        return parseInt((p * pageSum)) + 1;
    }
}
// funcs used internally
function parseHTML(htmlString) {
    let nodes = [];
    let $html = document.createElement("div");
    let $htmlNodes;
    $html.innerHTML = htmlString;
    $htmlNodes = $html.childNodes;
    for (var i = 0; i < $htmlNodes.length; i++) {
        if ($htmlNodes[i].nodeType != 1) {
            continue;
        }
        else {
            nodes.push({
                type: $htmlNodes[i].tagName.toLowerCase(),
                props: {
                    children: $htmlNodes[i].innerHTML
                }
            });
        }
    }
    return nodes;
}
function parseNodes(nodes) {
    let html = '';
    for (let i = 0; i < nodes.length; i++) {
        if (nodes[i].type !== 'p') {
            console.error('Unsupported node found!');
            continue;
        }
        else {
            html += `<p>${nodes[i].props.children}</p>`;
        }
    }
    return html;
}
function groupNodesByPage(nodes, nodeHeights, pageHeight) {
    let pages = [];
    let pageHeightSum = nodeHeights.reduce((a, b) => (a + b), 0);
    let pageSum = Math.ceil(pageHeightSum / pageHeight);
    nodes = nodes.map((node, index) => {
        node.props.index = index;
        return node;
    });
    // long paragraph situation doesn't seem to affect this function
    // offset distance is always negtive or zero
    // the index will be of the paragraph with this offset at the end
    const getPageOffset = function (pageIndex) {
        let offset = 0;
        let i = 0;
        let index;
        if (pageIndex !== 0) {
            let nodeHeightSum = 0;
            while (nodeHeightSum <= pageHeight * pageIndex) {
                nodeHeightSum += nodeHeights[i];
                i++;
            }
            offset = nodeHeightSum - nodeHeights[i - 1] - pageIndex * pageHeight;
            index = i - 1;
        }
        else {
            index = 0;
        }
        return {
            offset,
            index
        };
    };
    const getNodesOfPage = function (pageIndex) {
        let offsetObject = getPageOffset(pageIndex);
        let nodeStartIndex = offsetObject.index;
        let offset = offsetObject.offset;
        let i = nodeStartIndex;
        let nodeEndIndex;
        let pageNodes = [];
        let nodeHeightSum = offset + nodeHeights[nodeStartIndex];
        i++;
        if (nodeHeightSum < pageHeight) {
            while (nodeHeightSum <= pageHeight && i !== nodes.length) {
                nodeHeightSum += nodeHeights[i];
                i++;
            }
            nodeEndIndex = i - 1;
        }
        else {
            nodeEndIndex = nodeStartIndex;
        }
        for (let i = nodeStartIndex; i <= nodeEndIndex && i <= nodes.length - 1; i++) {
            pageNodes.push(nodes[i]);
        }
        return [pageNodes, offset];
    };
    // finally
    for (let i = 0; i < pageSum; i++) {
        let array = getNodesOfPage(i);
        let nodes = array[0];
        let offset = array[1];
        pages.push({
            props: {
                children: nodes,
                style: {
                    top: i * pageHeight,
                    position: 'absolute',
                    height: pageHeight
                },
                pageNo: i + 1,
                offset
            },
            type: "page"
        });
    }
    return pages;
}

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInV0aWxzL3JlbmRlckJvb2sudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUEsNEJBQTRCLE1BQU07SUFDaEMsSUFBSSxFQUFDLFNBQVMsRUFBRSxRQUFRLEVBQUUsTUFBTSxFQUFFLEtBQUssRUFBQyxHQUFHLE1BQU0sQ0FBQTtJQUNqRCxJQUFJLFFBQVEsR0FBRyxFQUFFLENBQUE7SUFFakIsT0FBTyxTQUFTLEdBQUcsTUFBTSxHQUFHLENBQUMsRUFBRSxDQUFDO1FBQzlCLE1BQU0sRUFBRSxDQUFBO0lBQ1YsQ0FBQztJQUNELFNBQVMsR0FBRyxTQUFTLEdBQUcsTUFBTSxDQUFBO0lBRTlCLEdBQUcsQ0FBQyxDQUFDLElBQUksQ0FBQyxHQUFHLFNBQVMsRUFBRSxDQUFDLEdBQUcsUUFBUSxHQUFHLFNBQVMsSUFBSSxDQUFDLEdBQUcsS0FBSyxDQUFDLE1BQU0sRUFBRSxDQUFDLEVBQUUsRUFBRSxDQUFDO1FBQzFFLElBQUksSUFBSSxHQUFHLEtBQUssQ0FBQyxDQUFDLENBQUMsQ0FBQTtRQUNuQixRQUFRLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxDQUFBO0lBQ3JCLENBQUM7SUFFRCxNQUFNLENBQUMsUUFBUSxDQUFBO0FBQ2pCLENBQUM7QUFHRCw0QkFBNEIsSUFBSSxFQUFFLFdBQVcsRUFBRSxJQUFJO0lBQ2pELElBQUksVUFBVSxHQUFHLElBQUksQ0FBQyxVQUFVLENBQUE7SUFDaEMsSUFBSSxLQUFLLEdBQUcsU0FBUyxDQUFDLElBQUksQ0FBQyxDQUFBO0lBQzNCLElBQUksS0FBSyxHQUFHLGdCQUFnQixDQUFDLEtBQUssRUFBRSxXQUFXLEVBQUUsVUFBVSxDQUFDLENBQUE7SUFFNUQsTUFBTSxDQUFDO1FBQ0wsSUFBSSxFQUFFLE9BQU87UUFDYixLQUFLLEVBQUU7WUFDTCxRQUFRLEVBQUUsS0FBSztZQUNmLElBQUk7U0FDTDtLQUNGLENBQUE7QUFDSCxDQUFDO0FBRUQsNEJBQTRCLEtBQUs7SUFDL0IsSUFBSSxLQUFLLEdBQUcsS0FB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LEdBQUMsVUFBVTtvQkFDakIsUUFBUSxFQUFFLFVBQVU7b0JBQ3BCLE1BQU0sRUFBRSxVQUFVO2lCQUNuQjtnQkFDRCxNQUFNLEVBQUUsQ0FBQyxHQUFDLENBQUM7Z0JBQ1gsTUFBTTthQUNQO1lBQ0QsSUFBSSxFQUFFLE1BQU07U0FDYixDQUFDLENBQUE7SUFDSixDQUFDO0lBRUQsTUFBTSxDQUFDLEtBQUssQ0FBQTtBQUNkLENBQUMiLCJmaWxlIjoidXRpbHMvcmVuZGVyQm9vay5qcyIsInNvdXJjZXNDb250ZW50IjpbImV4cG9ydCBmdW5jdGlvbiBmaWx0ZXJQYWdlcyhjb25maWcpIHtcbiAgbGV0IHtzdGFydFBhZ2UsIHF1YW50aXR5LCBvZmZzZXQsIHBhZ2VzfSA9IGNvbmZpZ1xuICBsZXQgbmV3UGFnZXMgPSBbXVxuXG4gIHdoaWxlIChzdGFydFBhZ2UgLSBvZmZzZXQgPCAwKSB7XG4gICAgb2Zmc2V0LS1cbiAgfVxuICBzdGFydFBhZ2UgPSBzdGFydFBhZ2UgLSBvZmZzZXRcblxuICBmb3IgKGxldCBpID0gc3RhcnRQYWdlOyBpIDwgcXVhbnRpdHkgKyBzdGFydFBhZ2UgJiYgaSA8IHBhZ2VzLmxlbmd0aDsgaSsrKSB7XG4gICAgbGV0IHBhZ2UgPSBwYWdlc1tpXVxuICAgIG5ld1BhZ2VzLnB1c2gocGFnZSlcbiAgfVxuXG4gIHJldHVybiBuZXdQYWdlc1xufVxuXG5cbmV4cG9ydCBmdW5jdGlvbiBodG1sVG9QYWdlcyhodG1sLCBub2RlSGVpZ2h0cywgdmlldykge1xuICBsZXQgcGFnZUhlaWdodCA9IHZpZXcucGFnZUhlaWdodFxuICBsZXQgbm9kZXMgPSBwYXJzZUhUTUwoaHRtbClcbiAgbGV0IHBhZ2VzID0gZ3JvdXBOb2Rlc0J5UGFnZShub2Rlcywgbm9kZUhlaWdodHMsIHBhZ2VIZWlnaHQpXG5cbiAgcmV0dXJuIHtcbiAgICB0eXBlOiAncGFnZXMnLFxuICAgIHByb3BzOiB7XG4gICAgICBjaGlsZHJlbjogcGFnZXMsXG4gICAgICB2aWV3XG4gICAgfVxuICB9XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBwYWdlc1RvSHRtbChwYWdlcykge1xuICBsZXQgbm9kZXMgPSBwYWdlcy5wcm9wcy5jaGlsZHJlbi5yZWR1Y2UoKGEsIGIpID0+IChhLmNvbmNhdChiLnByb3BzLmNoaWxkcmVuKSksW10pXG4gIGxldCB1bmlxdWVOb2RlcyA9IFtdXG4gIGxldCByZWFsSW5kZXggPSAwXG5cbiAgLy8gcmVtb3ZlIGR1cGxpY2F0ZSBub2Rlc1xuICBmb3IgKHZhciBpID0gMDsgaSA8IG5vZGVzLmxlbmd0aDsgaSsrKSB7XG4gICAgbm9kZXNbaV1cbiAgICBpZihub2Rlc1tpXS5wcm9wcy5pbmRleCA9PT0gcmVhbEluZGV4KSB7XG4gICAgICB1bmlxdWVOb2Rlcy5wdXNoKG5vZGVzW2ldKVxuICAgICAgcmVhbEluZGV4KytcbiAgICB9XG4gIH1cblxuICBsZXQgaHRtbCA9IHBhcnNlTm9kZXModW5pcXVlTm9kZXMpXG5cbiAgcmV0dXJuIGh0bWxcbn1cblxuXG5leHBvcnQgZnVuY3Rpb24gZ2V0Tm9kZUhlaWdodHMobm9kZXMpIHtcbiAgbGV0IG5vZGVzSGVpZ2h0ID0gW11cblxuICBBcnJheS5wcm90b3R5cGUuZm9yRWFjaC5jYWxsKG5vZGVzLCAobm9kZSwgaW5kZXgpID0+IHtcbiAgIGlmKG5vZGUudGFnTmFtZS50b0xvd2VyQ2FzZSgpICE9PSBcInBcIikge1xuICAgICBjb25zb2xlLmVycm9yKFwiVW5zdXBwb3J0ZWQgY29udGVudCBmb3VuZCFcIilcbiAgIH1cbiAgIG5vZGVzSGVpZ2h0LnB1c2gobm9kZS5jbGllbnRIZWlnaHQpXG4gIH0pXG5cbiAgcmV0dXJuIG5vZGVzSGVpZ2h0XG59XG5cblxuZXhwb3J0IGZ1bmN0aW9uIHBlcmNlbnRhZ2VUb1BhZ2UocDpudW1iZXIsIHBhZ2VTdW06bnVtYmVyKSB7XG4gIGlmKHA+MSkge1xuICAgIGNvbnNvbGUuZXJyb3IoXCJXcm9uZyBwYXJhbWV0ZXIhXCIpXG4gICAgcmV0dXJuIG51bGxcbiAgfSBlbHNlIHtcbiAgICByZXR1cm4gcGFyc2VJbnQoKHAgKiBwYWdlU3VtKSBhcyBhbnkpICsgMVxuICB9XG59XG5cbi8vIGZ1bmNzIHVzZWQgaW50ZXJuYWxseVxuXG5mdW5jdGlvbiBwYXJzZUhUTUwoaHRtbFN0cmluZzogc3RyaW5nKSB7XG4gIGxldCBub2RlcyA9IFtdXG4gIGxldCAkaHRtbCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJkaXZcIilcbiAgbGV0ICRodG1sTm9kZXNcblxuICAkaHRtbC5pbm5lckhUTUwgPSBodG1sU3RyaW5nXG4gICRodG1sTm9kZXMgPSAkaHRtbC5jaGlsZE5vZGVzXG5cbiAgZm9yICh2YXIgaSA9IDA7IGkgPCAkaHRtbE5vZGVzLmxlbmd0aDsgaSsrKSB7XG4gICAgaWYoJGh0bWxOb2Rlc1tpXS5ub2RlVHlwZSAhPSAxKSB7XG4gICAgICBjb250aW51ZVxuICAgIH1lbHNle1xuICAgICAgbm9kZXMucHVzaCh7XG4gICAgICAgIHR5cGU6ICRodG1sTm9kZXNbaV0udGFnTmFtZS50b0xvd2VyQ2FzZSgpLFxuICAgICAgICBwcm9wczoge1xuICAgICAgICAgIGNoaWxkcmVuOiAkaHRtbE5vZGVzW2ldLmlubmVySFRNTFxuICAgICAgICB9XG4gICAgICB9KVxuICAgIH1cbiAgfVxuICByZXR1cm4gbm9kZXNcbn1cblxuZnVuY3Rpb24gcGFyc2VOb2Rlcyhub2Rlcykge1xuICBsZXQgaHRtbCA9ICcnXG5cbiAgZm9yIChsZXQgaSA9IDA7IGkgPCBub2Rlcy5sZW5ndGg7IGkrKykge1xuICAgIGlmKG5vZGVzW2ldLnR5cGUgIT09ICdwJykge1xuICAgICAgY29uc29sZS5lcnJvcignVW5zdXBwb3J0ZWQgbm9kZSBmb3VuZCEnKVxuICAgICAgY29udGludWVcbiAgICB9ZWxzZXtcbiAgICAgIGh0bWwgKz0gYDxwPiR7bm9kZXNbaV0ucHJvcHMuY2hpbGRyZW59PC9wPmBcbiAgICB9XG4gIH1cblxuICByZXR1cm4gaHRtbFxufVxuXG5mdW5jdGlvbiBncm91cE5vZGVzQnlQYWdlKG5vZGVzLCBub2RlSGVpZ2h0cywgcGFnZUhlaWdodCkge1xuICBsZXQgcGFnZXMgPSBbXVxuICBsZXQgcGFnZUhlaWdodFN1bSA9IG5vZGVIZWlnaHRzLnJlZHVjZSgoYSwgYikgPT4gKGErYiksIDApXG4gIGxldCBwYWdlU3VtID0gTWF0aC5jZWlsKHBhZ2VIZWlnaHRTdW0vcGFnZUhlaWdodClcblxuICBub2RlcyA9IG5vZGVzLm1hcCgobm9kZSwgaW5kZXgpID0+IHtcbiAgICBub2RlLnByb3BzLmluZGV4ID0gaW5kZXhcbiAgICByZXR1cm4gbm9kZVxuICB9KVxuXG4gIC8vIGxvbmcgcGFyYWdyYXBoIHNpdHVhdGlvbiBkb2Vzbid0IHNlZW0gdG8gYWZmZWN0IHRoaXMgZnVuY3Rpb25cbiAgLy8gb2Zmc2V0IGRpc3RhbmNlIGlzIGFsd2F5cyBuZWd0aXZlIG9yIHplcm9cbiAgLy8gdGhlIGluZGV4IHdpbGwgYmUgb2YgdGhlIHBhcmFncmFwaCB3aXRoIHRoaXMgb2Zmc2V0IGF0IHRoZSBlbmRcbiAgY29uc3QgZ2V0UGFnZU9mZnNldCA9IGZ1bmN0aW9uKHBhZ2VJbmRleCkge1xuICAgIGxldCBvZmZzZXQgPSAwXG4gICAgbGV0IGkgPSAwXG4gICAgbGV0IGluZGV4XG5cbiAgICBpZihwYWdlSW5kZXggIT09IDApIHtcbiAgICAgIGxldCBub2RlSGVpZ2h0U3VtID0gMFxuICAgICAgd2hpbGUobm9kZUhlaWdodFN1bSA8PSBwYWdlSGVpZ2h0ICogcGFnZUluZGV4KSB7XG4gICAgICAgIG5vZGVIZWlnaHRTdW0gKz0gbm9kZUhlaWdodHNbaV1cbiAgICAgICAgaSsrXG4gICAgICB9XG4gICAgICBvZmZzZXQgPSBub2RlSGVpZ2h0U3VtIC0gbm9kZUhlaWdodHNbaS0xXSAtIHBhZ2VJbmRleCAqIHBhZ2VIZWlnaHRcbiAgICAgIGluZGV4ID0gaSAtIDFcbiAgICB9IGVsc2Uge1xuICAgICAgaW5kZXggPSAwXG4gICAgfVxuXG4gICAgcmV0dXJuIHtcbiAgICAgIG9mZnNldCxcbiAgICAgIGluZGV4XG4gICAgfVxuICB9XG5cbiAgY29uc3QgZ2V0Tm9kZXNPZlBhZ2UgPSBmdW5jdGlvbihwYWdlSW5kZXgpIHtcbiAgICBsZXQgb2Zmc2V0T2JqZWN0ID0gZ2V0UGFnZU9mZnNldChwYWdlSW5kZXgpXG4gICAgbGV0IG5vZGVTdGFydEluZGV4ID0gb2Zmc2V0T2JqZWN0LmluZGV4XG4gICAgbGV0IG9mZnNldCA9IG9mZnNldE9iamVjdC5vZmZzZXRcblxuXG4gICAgbGV0IGkgPSBub2RlU3RhcnRJbmRleFxuICAgIGxldCBub2RlRW5kSW5kZXhcbiAgICBsZXQgcGFnZU5vZGVzID0gW11cblxuICAgIGxldCBub2RlSGVpZ2h0U3VtID0gb2Zmc2V0ICsgbm9kZUhlaWdodHNbbm9kZVN0YXJ0SW5kZXhdXG4gICAgaSsrXG5cbiAgICBpZihub2RlSGVpZ2h0U3VtIDwgcGFnZUhlaWdodCkge1xuICAgICAgd2hpbGUgKG5vZGVIZWlnaHRTdW0gPD0gcGFnZUhlaWdodCAmJiBpICE9PSBub2Rlcy5sZW5ndGgpIHtcbiAgICAgICAgbm9kZUhlaWdodFN1bSArPSBub2RlSGVpZ2h0c1tpXVxuICAgICAgICBpKytcbiAgICAgIH1cbiAgICAgIG5vZGVFbmRJbmRleCA9IGkgLSAxXG4gICAgfWVsc2V7XG4gICAgICBub2RlRW5kSW5kZXggPSBub2RlU3RhcnRJbmRleFxuICAgIH1cblxuICAgIGZvcihsZXQgaSA9IG5vZGVTdGFydEluZGV4OyBpIDw9IG5vZGVFbmRJbmRleCAmJiBpIDw9IG5vZGVzLmxlbmd0aCAtIDE7IGkrKykge1xuICAgICAgcGFnZU5vZGVzLnB1c2gobm9kZXNbaV0pXG4gICAgfVxuXG4gICAgcmV0dXJuIFtwYWdlTm9kZXMsIG9mZnNldF1cbiAgfVxuXG4gIC8vIGZpbmFsbHlcbiAgZm9yKGxldCBpID0gMDsgaSA8IHBhZ2VTdW07IGkrKykge1xuICAgIGxldCBhcnJheSA9IGdldE5vZGVzT2ZQYWdlKGkpXG4gICAgbGV0IG5vZGVzID0gYXJyYXlbMF1cbiAgICBsZXQgb2Zmc2V0ID0gYXJyYXlbMV1cblxuICAgIHBhZ2VzLnB1c2goe1xuICAgICAgcHJvcHM6IHtcbiAgICAgICAgY2hpbGRyZW46IG5vZGVzLFxuICAgICAgICBzdHlsZToge1xuICAgICAgICAgIHRvcDogaSpwYWdlSGVpZ2h0LFxuICAgICAgICAgIHBvc2l0aW9uOiAnYWJzb2x1dGUnLFxuICAgICAgICAgIGhlaWdodDogcGFnZUhlaWdodFxuICAgICAgICB9LFxuICAgICAgICBwYWdlTm86IGkrMSxcbiAgICAgICAgb2Zmc2V0XG4gICAgICB9LFxuICAgICAgdHlwZTogXCJwYWdlXCJcbiAgICB9KVxuICB9XG5cbiAgcmV0dXJuIHBhZ2VzXG59XG4iXSwic291cmNlUm9vdCI6Ii9zb3VyY2UvIn0=
