webpackJsonp([0],{0:function(a,b,c){a.exports=c(1)},1:function(a,b,c){"use strict";function d(a){return a&&a.__esModule?a:{"default":a}}var e=c(2),f=c(143),g=d(f),h=c(155),i=c(212),j=d(i),k=c(295),l=d(k),m=(0,l["default"])();(0,e.render)(g["default"].createElement(j["default"],{store:m,history:h.browserHistory}),document.getElementById("root"))},212:function(a,b,c){"use strict";var d=c(213);(0,d.getEnv)();a.exports=c(220)},213:function(a,b,c){"use strict";function d(){var a="production";return"undefined"!=typeof window&&(a=window.process.env.NODE_ENV),a}function e(a,b,c){"undefined"==typeof b&&(b="get");var d="json";-1!==a.indexOf("http")&&(d="jsonp");var e={url:a,type:b,dataType:d};return"undefined"!=typeof c&&(e=Object.assign({},e,{data:c})),new Promise(function(a,b){fetch(e.url).then(function(a){return console.log(a),a.json()}).then(function(b){console.log(b),a(b)})["catch"](function(a){b(a)})})}function f(a,b){return console.log(this),function(){clearTimeout(this.__delayStuffTimer__),this.__delayStuffTimer__=setTimeout(a.bind(this),b)}}function g(a,b){var c=this,d=[];return function(){console.log(d),clearTimeout(d.slice(-1)[0]);var e=setTimeout(a.bind(c),b);d.push(e)}}function h(a){"undefined"==typeof a&&(a=null);var b=document.createElement("b");return b.innerHTML="<!--[if IE "+a+"]><i></i><![endif]-->",1===b.getElementsByTagName("i").length}Object.defineProperty(b,"__esModule",{value:!0});var i=c(214);Object.keys(i).forEach(function(a){"default"!==a&&Object.defineProperty(b,a,{enumerable:!0,get:function(){return i[a]}})});var j=c(216);Object.keys(j).forEach(function(a){"default"!==a&&Object.defineProperty(b,a,{enumerable:!0,get:function(){return j[a]}})});var k=c(217);Object.keys(k).forEach(function(a){"default"!==a&&Object.defineProperty(b,a,{enumerable:!0,get:function(){return k[a]}})}),b.getEnv=d,b.callApi=e,b.delayStuff=f,b.lazilize=g,b.isIE=h;c(215)},214:function(a,b,c){"use strict";function d(a,b,c){function d(a){var d=k(a),g=j(".pages ul>li>.content",b),h=e(d,g,f);return{type:"pages",props:{children:h,view:c}}}var f=c.pageHeight;c.pageWidth,c.screen;return b.setView(c),new Promise(function(e,f){b.wrap(function(g,h){var i=(0,o.getCache)("book"+a+"_pages");if(i)if(i=JSON.parse(i),m(c,i.props.view))b.loadPages(i),b.setBookMode("vertical"),e({pages:i});else{var j;!function(){var c=i.props.children.reduce(function(a,b){return a.concat(b.props.children)},[]),f=[],g=0;for(j=0;j<c.length;j++)c[j],c[j].props.index===g&&(f.push(c[j]),g++);var h=l(f);b.promisedWrap(function(a){b.loadHTML(h)}).then(function(c){i=d(h),b.loadPages(i),(0,o.setCache)("book"+a+"_pages",JSON.stringify(i)),e({pages:i})})}()}else b.fetchBookContent(a,"books/"+a+"/content").then(function(c){var f=d(c().book.html);b.loadPages(f),(0,o.setCache)("book"+a+"_pages",JSON.stringify(f)),e({pages:f})})["catch"](function(a){console.error(a),f(a)})})})}function e(a,b,c){var d=[],e=b.reduce(function(a,b){return a+b},0),f=Math.ceil(e/c);a=a.map(function(a,b){return a.props.index=b,a});for(var g=function(a){var d=0,e=0,f=void 0;if(0!==a){for(var g=0;c*a>=g;)g+=b[e],e++;d=g-b[e-1]-a*c,f=e-1}else f=0;return{offset:d,index:f}},h=function(d){var e=g(d),f=e.index,h=e.offset,i=f,j=void 0,k=[],l=h+b[f];if(i++,c>l){for(;c>=l&&i!==a.length;)l+=b[i],i++;j=i-1}else j=f;for(var m=f;j>=m&&m<=a.length-1;m++)k.push(a[m]);return[k,h]},i=0;f>i;i++){var j=h(i),k=j[0],l=j[1];d.push({props:{children:k,style:{top:i*c,position:"absolute",height:c},pageNo:i+1,offset:l},type:"page"})}return d}function f(a,b){return a>1?(console.error("Wrong parameter!"),null):parseInt(a*b)+1}function g(a){for(var b=a.startPage,c=a.quantity,d=a.offset,e=a.pages,f=[];0>b-d;)d--;b-=d;for(var g=b;c+b>g&&g<e.length;g++){var h=e[g];f.push(h)}return f}function h(a){return new Promise(function(b,c){(0,o.callApi)(p.API_ROOT+"books/"+a+"/progress").then(function(a){b(a)},function(a){c(a)})})}function i(a,b){return new Promise(function(c){(0,o.callApi)(p.API_ROOT+"books/"+a+"/progress","POST",b).then(function(a){c(a)})})}function j(a,b){b.setBookMode("render");var c=document.querySelector(a).childNodes,d=[];return Array.prototype.forEach.call(c,function(a,b){"p"!==a.tagName.toLowerCase()&&console.error("Unsupported content found!"),d.push(a.clientHeight)}),b.setBookMode("vertical"),d}function k(a){var b=[],c=document.createElement("div");c.innerHTML=a,c=c.childNodes;for(var d=0;d<c.length;d++)1==c[d].nodeType&&b.push({type:c[d].tagName.toLowerCase(),props:{children:c[d].innerHTML}});return b}function l(a){for(var b="",c=0;c<a.length;c++)"p"===a[c].type?b+="<p>"+a[c].props.children+"</p>":console.error("Unsupported node found!");return b}function m(a,b){var c=!0;try{for(var d in a)if(a[d]!==b[d]){c=!1;break}}catch(e){console.error(e),c=!1}return c}function n(){var a=7/9;return window.innerWidth<=540?{screen:"phone",pageWidth:window.innerWidth,pageHeight:window.innerWidth/a}:{screen:"hd",pageWidth:700,pageHeight:700/a}}Object.defineProperty(b,"__esModule",{value:!0}),b.initBook=d,b.groupNodesByPage=e,b.convertPercentageToPage=f,b.filterPages=g,b.getProgress=h,b.setProgress=i,b.getView=n;var o=c(213),p=c(215)},215:function(a,b){"use strict";Object.defineProperty(b,"__esModule",{value:!0});var c="v0.1";b.API_ROOT="/api/"+c+"/",b.API_DOUBAN_BOOKS="https://api.douban.com/v2/book/"},216:function(a,b){"use strict";function c(a){"string"!=typeof a&&console.error("Name should be string!");var b=localStorage.getItem(a);return b||(b=!1),b}function d(a,b){"string"!=typeof a&&console.error("Name should be string!"),"string"!=typeof b&&console.error("Cache content should be string!");var c=!0;try{localStorage.setItem(a,b)}catch(d){console.error(d),c=!1}return c}Object.defineProperty(b,"__esModule",{value:!0}),b.getCache=c,b.setCache=d},217:function(a,b,c){"use strict";function d(a){return a&&a.__esModule?a:{"default":a}}function e(a,b,c){for(var d=g["default"].cloneDeep(a),e={},f=0,h=0,i=0,j=!0,k=0,l=0,m=0,n=0,o=[],p={};i<d.length&&f<b.pageHeight*c;)f=parseInt(d[i].props.style.height)+f,h=f-parseInt(d[i].props.style.height),f>b.pageHeight*(c-1)&&1==j&&(k=i,m=h-b.pageHeight*(c-1),j=!1),l=i,i++;for(n=(c-1)*b.pageHeight,i=k;l>=i;i++)switch(d[i].type){case"p":o.push(d[i]);break;default:console.error("Unsupported content found!")}return p="VERTICAL"===b.mode?{top:n,position:"absolute"}:{top:n,position:"absolute"},o[0].props.style.marginTop=m,e={props:{children:o,style:p,pageNo:c},type:"page"}}Object.defineProperty(b,"__esModule",{value:!0}),b.filterContentNodesByPage=e;var f=c(218),g=d(f)},220:function(a,b,c){"use strict";function d(a){return a&&a.__esModule?a:{"default":a}}function e(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function f(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!b||"object"!=typeof b&&"function"!=typeof b?a:b}function g(a,b){if("function"!=typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}Object.defineProperty(b,"__esModule",{value:!0});var h=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),i=c(143),j=d(i),k=c(221),l=c(242),m=d(l),n=c(155),o=(c(213),function(a){function b(){return e(this,b),f(this,Object.getPrototypeOf(b).apply(this,arguments))}return g(b,a),h(b,[{key:"render",value:function(){var a=this.props,b=a.store,c=a.history;return j["default"].createElement(k.Provider,{store:b},j["default"].createElement(n.Router,{history:c,routes:m["default"]}))}}]),b}(i.Component));b["default"]=o,o.propTypes={store:i.PropTypes.object.isRequired,history:i.PropTypes.object.isRequired}},242:function(a,b,c){"use strict";function d(a){return a&&a.__esModule?a:{"default":a}}Object.defineProperty(b,"__esModule",{value:!0});var e=c(143),f=d(e),g=c(155),h=c(243),i=d(h),j=c(244),k=(d(j),c(245)),l=(d(k),c(274)),m=d(l),n=c(286),o=d(n),p=c(290),q=d(p),r=c(292),s=d(r),t=c(293),u=d(t),v=c(294),w=d(v);b["default"]=f["default"].createElement(g.Router,{path:"/",component:i["default"]},f["default"].createElement(g.IndexRoute,{component:o["default"]}),f["default"].createElement(g.Route,{path:"/bookstore",component:o["default"]}),f["default"].createElement(g.Route,{path:"signin",component:q["default"]}),f["default"].createElement(g.Route,{path:"Signup",component:s["default"]}),f["default"].createElement(g.Route,{path:"addbook",component:u["default"]}),f["default"].createElement(g.Route,{path:"bookstore/book/:id",component:w["default"]}),f["default"].createElement(g.Route,{path:"book/:id",component:m["default"]}))},243:function(a,b,c){"use strict";function d(a){return a&&a.__esModule?a:{"default":a}}function e(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function f(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!b||"object"!=typeof b&&"function"!=typeof b?a:b}function g(a,b){if("function"!=typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}Object.defineProperty(b,"__esModule",{value:!0});var h=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),i=c(143),j=d(i),k=(c(221),function(a){function b(a){return e(this,b),f(this,Object.getPrototypeOf(b).call(this,a))}return g(b,a),h(b,[{key:"render",value:function(){return j["default"].createElement("div",null,this.props.children)}}]),b}(i.Component));b["default"]=k},244:function(a,b,c){"use strict";function d(a){return a&&a.__esModule?a:{"default":a}}Object.defineProperty(b,"__esModule",{value:!0});var e=c(143),f=d(e),g=f["default"].createClass({displayName:"NoMatch",componentDidMount:function(){},handleClick:function(){},render:function(){return f["default"].createElement("h2",null,"404")}});b["default"]=g},245:function(a,b,c){"use strict";function d(a){return a&&a.__esModule?a:{"default":a}}function e(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function f(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!b||"object"!=typeof b&&"function"!=typeof b?a:b}function g(a,b){if("function"!=typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}Object.defineProperty(b,"__esModule",{value:!0});var h=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),i=c(143),j=d(i),k=c(155),l=c(246),m=c(273),n=d(m),o=function(a){function b(){return e(this,b),f(this,Object.getPrototypeOf(b).apply(this,arguments))}return g(b,a),h(b,[{key:"componentDidMount",value:function(){}},{key:"render",value:function(){return j["default"].createElement("div",{className:"page-home"},j["default"].createElement(n["default"],null),j["default"].createElement(l.Container,null,j["default"].createElement("div",null,j["default"].createElement("h1",{className:"page-title"},"This is home, bitch!!!!"),j["default"].createElement("ul",null,j["default"].createElement("li",null,j["default"].createElement(k.Link,{to:"/bookstore"},"查看书城")),j["default"].createElement("li",null,j["default"].createElement(k.Link,{to:"/addbook"},"添加书籍"))))))}}]),b}(i.Component);b["default"]=o},273:function(a,b,c){"use strict";function d(a){return a&&a.__esModule?a:{"default":a}}function e(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function f(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!b||"object"!=typeof b&&"function"!=typeof b?a:b}function g(a,b){if("function"!=typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}Object.defineProperty(b,"__esModule",{value:!0});var h=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),i=c(143),j=d(i),k=c(155),l=c(246),m=(c(213),function(a){function b(){return e(this,b),f(this,Object.getPrototypeOf(b).apply(this,arguments))}return g(b,a),h(b,[{key:"render",value:function(){var a=this.props.user;return j["default"].createElement(l.Appbar,{className:"branding"},j["default"].createElement(l.Container,null,j["default"].createElement("div",null,j["default"].createElement("h1",{className:"logo left"},j["default"].createElement(k.Link,{to:"/"},"readr")),a.authed?j["default"].createElement("ul",{className:"right mui-list--inline mui--text-body2"},j["default"].createElement("li",null,j["default"].createElement(k.Link,{to:"/profile/"+a.username},a.username)),j["default"].createElement("li",null,j["default"].createElement("a",{href:"/logout"},"退出"))):j["default"].createElement("ul",{className:"right mui-list--inline mui--text-body2"},j["default"].createElement("li",null,j["default"].createElement(k.Link,{to:"/signin"},"登录")),j["default"].createElement("li",null,j["default"].createElement(k.Link,{to:"/signup"},"注册"))))))}}]),b}(i.Component));m.propTypes={user:j["default"].PropTypes.object.isRequired},b["default"]=m},274:function(a,b,c){"use strict";function d(a){if(a&&a.__esModule)return a;var b={};if(null!=a)for(var c in a)Object.prototype.hasOwnProperty.call(a,c)&&(b[c]=a[c]);return b["default"]=a,b}function e(a){return a&&a.__esModule?a:{"default":a}}function f(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function g(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!b||"object"!=typeof b&&"function"!=typeof b?a:b}function h(a,b){if("function"!=typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}Object.defineProperty(b,"__esModule",{value:!0});var i=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),j=c(143),k=e(j),l=c(155),m=c(221),n=c(227),o=c(275),p=(e(o),c(218)),q=e(p),r=c(213),s=c(276),t=d(s),u=(c(215),c(282)),v=e(u),w=c(284),x=e(w),y=c(285),z=e(y),A=void 0;"undefined"!=typeof window&&(A=window.innerWidth);var B={},C={},D=!1,E=function(a){function b(a){f(this,b);var c=g(this,Object.getPrototypeOf(b).call(this,a));return c.bookId=a.params.id,c.state={showPanel:!1,isListenersAdded:!1},c}return h(b,a),i(b,[{key:"scrollToLoadPages",value:function(){var a=this.props,b=a.book.pages.props.children,c=b.length,d=Number((document.body.scrollTop/(a.book.pages.props.view.pageHeight*c)).toFixed(4)),e=(0,r.convertPercentageToPage)(d,c),f=2,g={pageNo:e,pageSum:c,percentage:d};C=g,a.actions.jumpTo(e),this.props.user.authed&&(0,r.getProgress)(a.book.id).then(function(b){q["default"].isEmpty(b)?(0,r.setProgress)(a.book.id,g):(B=b,d+f/c<=b.percentage&&!D?a.actions.showConfirm("是否跳转到最新进度？"):((0,r.setProgress)(a.book.id,g),D=!1))})}},{key:"scrollTo",value:function(a){var b=this.props;1>a?(b.actions.jumpTo((0,r.convertPercentageToPage)(a,b.book.pages.props.children.length)),document.body.scrollTop=b.book.pages.props.children.length*b.book.pages.props.view.pageHeight*a):(b.actions.jumpTo(a),document.body.scrollTop=b.book.pages.props.view.pageHeight*a)}},{key:"prepareBook",value:function(a,b,c){var d=this,e=b.actions,f=b.user;(0,r.initBook)(a,e,c).then(function(b){b.pages&&(f.authed?(0,r.getProgress)(a).then(function(a){d.scrollTo(a.percentage),d.setState({isLoading:!1})},function(a){d.setState({isLoading:!1}),e.jumpTo(1)}):(d.setState({isLoading:!1}),e.jumpTo(1),document.body.scrollTop=document.body.scrollTop+1))})}},{key:"addEventListeners",value:function(){function a(a,c){var d=this;return function(){clearTimeout(b.slice(-1)[0]);var e=setTimeout(a.bind(d),c);b.push(e)}}var b=[];this.handleScroll=a(this.scrollToLoadPages.bind(this),100),this.handleResize=function(){var b=(0,r.getView)();window.innerWidth!==A&&(this.setState({isLoading:!0}),A=window.innerWidth,a(this.prepareBook.bind(this,this.bookId,this.props,b),500)())}.bind(this),window.addEventListener("scroll",this.handleScroll),window.addEventListener("resize",this.handleResize)}},{key:"removeEventListeners",value:function(){window.removeEventListener("scroll",this.handleScroll),window.removeEventListener("resize",this.handleResize)}},{key:"toggleBookPanel",value:function(a){if("hd"===this.props.book.pages.props.view.screen){var b=a.pageY-document.body.scrollTop;90>b?this.setState({showPanel:!0}):this.setState({showPanel:!1})}}},{key:"clickToToggleBookPanel",value:function(){"phone"===this.props.book.pages.props.view.screen&&this.setState({showPanel:!this.state.showPanel})}},{key:"componentWillReceiveProps",value:function(a){this.props.confirm.isVisible===!0&&("yes"===a.confirm.result&&this.scrollTo(B.percentage),"no"===a.confirm.result&&(D=!0,this.scrollTo(C.percentage)))}},{key:"componentDidMount",value:function(){var a=this,b=this.props.actions,c=this.bookId;b.fetchUserAuthInfo(),b.fetchBookInfo(c,"books/"+this.bookId).then(function(d){a.prepareBook(c,Object.assign({},{actions:b},d()),(0,r.getView)())}),this.addEventListeners()}},{key:"componentWillUnmount",value:function(){this.removeEventListeners()}},{key:"render",value:function(){var a=this.props.book,b=a.pages?a.pages.props.children:null,c=[],d=this.props.view,e=b?b.length*d.pageHeight:"100%";if(a.isPagesLoaded){var f=a.currentPage;c=(0,r.filterPages)({startPage:f,offset:2,quantity:5,pages:b})}return k["default"].createElement("div",{className:"page-book-viewer book-viewer--"+d.screen,onMouseMove:this.toggleBookPanel.bind(this)},k["default"].createElement(z["default"],{confirm:this.props.confirm}),this.state.isLoading||a.isFetchingInfo||a.isFetchingContent?k["default"].createElement(x["default"],null):null,this.state.showPanel&&a.meta&&a.isPagesLoaded===!0?k["default"].createElement("div",{className:"functions"},k["default"].createElement("div",{className:"container"},k["default"].createElement("span",{className:"home"},k["default"].createElement(l.Link,{to:"/bookstore"})),k["default"].createElement("span",{className:"title"},a.meta.title),k["default"].createElement("span",{className:"loc"},a.currentPage+"/"+b.length))):null,"render"===a.mode?k["default"].createElement("div",{className:"pages"},k["default"].createElement("div",{className:"container"},k["default"].createElement("ul",null,k["default"].createElement("li",null,k["default"].createElement("div",{className:"content",dangerouslySetInnerHTML:{__html:a.html}}))))):null,"vertical"===a.mode?k["default"].createElement("div",{onClick:this.clickToToggleBookPanel.bind(this)},k["default"].createElement(v["default"],{height:e,view:a.view,bookId:this.bookId,pages:c})):null)}}]),b}(j.Component);E.propTypes={book:k["default"].PropTypes.object.isRequired},b["default"]=(0,m.connect)(function(a){return{book:a.book,user:a.user,view:a.view,confirm:a.confirm}},function(a){return{actions:(0,n.bindActionCreators)(t,a)}})(E)},276:function(a,b,c){"use strict";function d(a){if(a&&a.__esModule)return a;var b={};if(null!=a)for(var c in a)Object.prototype.hasOwnProperty.call(a,c)&&(b[c]=a[c]);return b["default"]=a,b}function e(a){return a&&a.__esModule?a:{"default":a}}function f(a){return{type:s,view:a}}function g(a,b){return function(c,d){function e(a){var c=Object.assign({},b,a);return c}var f=a.endpoint,g=a.apiUrl,h=a.types,i=j(h,3),k=i[0],l=i[1],m=i[2];c(e({type:k})),"function"==typeof f&&(f=f(d())),"undefined"==typeof g&&(g=r.API_ROOT);var n=g+f;return new Promise(function(a,b){(0,q.callApi)(n).then(function(b){c(e({response:b,type:l})),a(d)},function(a){c(e({type:m,error:a.message||"Oops!"})),b(a)})})}}function h(a){return function(b,c){a(b,c)}}function i(a){return function(b,c){return new Promise(function(d){a(b,c),d(c)})}}Object.defineProperty(b,"__esModule",{value:!0}),b.SET_VIEW=void 0;var j=function(){function a(a,b){var c=[],d=!0,e=!1,f=void 0;try{for(var g,h=a[Symbol.iterator]();!(d=(g=h.next()).done)&&(c.push(g.value),!b||c.length!==b);d=!0);}catch(i){e=!0,f=i}finally{try{!d&&h["return"]&&h["return"]()}finally{if(e)throw f}}return c}return function(b,c){if(Array.isArray(b))return b;if(Symbol.iterator in Object(b))return a(b,c);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),k=c(277);Object.keys(k).forEach(function(a){"default"!==a&&Object.defineProperty(b,a,{enumerable:!0,get:function(){return k[a]}})});var l=c(278);Object.keys(l).forEach(function(a){"default"!==a&&Object.defineProperty(b,a,{enumerable:!0,get:function(){return l[a]}})});var m=c(279);Object.keys(m).forEach(function(a){"default"!==a&&Object.defineProperty(b,a,{enumerable:!0,get:function(){return m[a]}})});var n=c(280);Object.keys(n).forEach(function(a){"default"!==a&&Object.defineProperty(b,a,{enumerable:!0,get:function(){return n[a]}})}),b.setView=f,b.promisedCallApi=g,b.wrap=h,b.promisedWrap=i;var o=c(218),p=(e(o),c(281)),q=(d(p),c(213)),r=c(215),s=b.SET_VIEW="SET_VIEW"},277:function(a,b,c){"use strict";function d(a){return(0,m.promisedCallApi)({types:["BOOK_LIST_REQUEST","BOOK_LIST_SUCCESS","BOOK_LIST_FAILURE"],endpoint:a},{})}function e(a){return(0,m.promisedCallApi)({types:["DOUBAN_BOOK_SEARCH_REQUEST","DOUBAN_BOOK_SEARCH_SUCCESS","DOUBAN_BOOK_SEARCH_FAILURE"],endpoint:a,apiUrl:n.API_DOUBAN_BOOKS},{})}function f(){return{type:o}}function g(a,b){return(0,m.promisedCallApi)({types:["BOOK_CONTENT_REQUEST","BOOK_CONTENT_SUCCESS","BOOK_CONTENT_FAILURE"],endpoint:b},{bookId:a})}function h(a,b){return(0,m.promisedCallApi)({types:["BOOK_INFO_REQUEST","BOOK_INFO_SUCCESS","BOOK_INFO_FAILURE"],endpoint:b},{bookId:a})}function i(a){return{type:p,html:a}}function j(a){return{type:q,mode:a}}function k(a){return{type:r,pages:a}}function l(a){return{type:s,currentPage:a}}Object.defineProperty(b,"__esModule",{value:!0}),b.JUMP_TO=b.LOAD_PAGES=b.SET_BOOK_MODE=b.LOAD_HTML=b.CLEAR_BOOK_SEARCH=void 0,b.fetchBookList=d,b.fetchDoubanBookSearchResults=e,b.clearBookSearch=f,b.fetchBookContent=g,b.fetchBookInfo=h,b.loadHTML=i,b.setBookMode=j,b.loadPages=k,b.jumpTo=l;var m=c(276),n=c(215),o=b.CLEAR_BOOK_SEARCH="CLEAR_BOOK_SEARCH",p=b.LOAD_HTML="LOAD_HTML",q=b.SET_BOOK_MODE="SET_BOOK_MODE",r=b.LOAD_PAGES="LOAD_PAGES",s=b.JUMP_TO="JUMP_TO"},278:function(a,b){"use strict";function c(a,b){return"undefined"==typeof b&&(b=3e3),function(c,f){c(d(a)),setTimeout(function(){c(e())},b)}}function d(a){return{type:f,content:a,isVisible:!0}}function e(){return{type:g,isVisible:!1}}Object.defineProperty(b,"__esModule",{value:!0}),b.handleNotification=c,b.showNotification=d,b.hideNotification=e;var f=b.SHOW_NOTIFICATION="SHOW_NOTIFICATION",g=b.HIDE_NOTIFICATION="HIDE_NOTIFICATION"},279:function(a,b,c){"use strict";function d(){return(0,e.promisedCallApi)({types:["USER_AUTH_INFO_REQUEST","USER_AUTH_INFO_SUCCESS","USER_AUTH_INFO_FAILURE"],endpoint:"auth"},{})}Object.defineProperty(b,"__esModule",{value:!0}),b.fetchUserAuthInfo=d;var e=c(276)},280:function(a,b){"use strict";function c(a){return{type:g,content:a,isVisible:!0}}function d(){return{type:h,isVisible:!1}}function e(){return{type:i,isVisible:!1,result:"yes"}}function f(){return{type:j,isVisible:!1,result:"no"}}Object.defineProperty(b,"__esModule",{value:!0}),b.showConfirm=c,b.hideConfirm=d,b.confirmYes=e,b.confirmNo=f;var g=b.SHOW_CONFIRM="SHOW_CONFIRM",h=b.HIDE_CONFIRM="HIDE_CONFIRM",i=b.CONFIRM_YES="CONFIRM_YES",j=b.CONFIRM_NO="CONFIRM_NO"},281:function(a,b){"use strict";Object.defineProperty(b,"__esModule",{value:!0});b.BOOK_HD_STYLE={fontSize:"18",lineHeight:"1.8",width:"700",height:"900"},b.BOOK_MOBILE_STYLE={fontSize:"22",lineHeight:"1.8",width:"100%",height:"100%"}},282:function(a,b,c){"use strict";function d(a){if(a&&a.__esModule)return a;var b={};if(null!=a)for(var c in a)Object.prototype.hasOwnProperty.call(a,c)&&(b[c]=a[c]);return b["default"]=a,b}function e(a){return a&&a.__esModule?a:{"default":a}}function f(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function g(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!b||"object"!=typeof b&&"function"!=typeof b?a:b}function h(a,b){if("function"!=typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}Object.defineProperty(b,"__esModule",{value:!0});var i=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),j=c(143),k=e(j),l=(c(155),c(281)),m=(d(l),c(283)),n=e(m),o=function(a){function b(){return f(this,b),g(this,Object.getPrototypeOf(b).apply(this,arguments))}return h(b,a),i(b,[{key:"render",value:function(){var a=this;return k["default"].createElement("div",{className:"pages"},k["default"].createElement("div",{className:"container"},k["default"].createElement("ul",{style:{height:this.props.height}},this.props.pages.map(function(b,c){return"page"===b.type?k["default"].createElement(n["default"],{style:b.props.style,bookId:a.props.bookId,key:c,page:b}):void console.error("Not type page!")}))))}}]),b}(j.Component);b["default"]=o},283:function(a,b,c){"use strict";function d(a){return a&&a.__esModule?a:{"default":a}}function e(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function f(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!b||"object"!=typeof b&&"function"!=typeof b?a:b}function g(a,b){if("function"!=typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}Object.defineProperty(b,"__esModule",{value:!0});var h=Object.assign||function(a){for(var b=1;b<arguments.length;b++){var c=arguments[b];for(var d in c)Object.prototype.hasOwnProperty.call(c,d)&&(a[d]=c[d])}return a},i=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),j=c(143),k=d(j),l=(c(155),function(a){function b(){return e(this,b),f(this,Object.getPrototypeOf(b).apply(this,arguments))}return g(b,a),i(b,[{key:"render",value:function(){var a=this.props.page,b=this.props.style;return k["default"].createElement("li",{style:b},k["default"].createElement("div",{className:"content"},a.props.children.map(function(b,c){return"p"!==b.type&&console.error("Unsupported content found!"),k["default"].createElement("p",h({},0===c?{style:{marginTop:a.props.offset}}:{},{key:c}),b.props.children)})),k["default"].createElement("div",{className:"page-no"},a.props.pageNo))}}]),b}(j.Component));b["default"]=l},284:function(a,b,c){"use strict";function d(a){return a&&a.__esModule?a:{"default":a}}function e(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function f(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!b||"object"!=typeof b&&"function"!=typeof b?a:b}function g(a,b){if("function"!=typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}Object.defineProperty(b,"__esModule",{value:!0});var h=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),i=c(143),j=d(i),k=function(a){function b(){return e(this,b),f(this,Object.getPrototypeOf(b).apply(this,arguments))}return g(b,a),h(b,[{key:"render",value:function(){return j["default"].createElement("div",{className:"loading-wrap"},j["default"].createElement("span",{className:"icon icon-loading"}))}}]),b}(i.Component);b["default"]=k},285:function(a,b,c){"use strict";function d(a){if(a&&a.__esModule)return a;var b={};if(null!=a)for(var c in a)Object.prototype.hasOwnProperty.call(a,c)&&(b[c]=a[c]);return b["default"]=a,b}function e(a){return a&&a.__esModule?a:{"default":a}}function f(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function g(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!b||"object"!=typeof b&&"function"!=typeof b?a:b}function h(a,b){if("function"!=typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}Object.defineProperty(b,"__esModule",{value:!0});var i=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),j=c(143),k=e(j),l=c(246),m=c(280),n=d(m),o=c(227),p=c(221),q=function(a){function b(a){return f(this,b),g(this,Object.getPrototypeOf(b).call(this,a))}return h(b,a),i(b,[{key:"render",value:function(){var a=this.props.confirm,b=this.props.actions;return k["default"].createElement("div",null,a.isVisible?k["default"].createElement("div",{className:"confirm-dialog mui--z1"},k["default"].createElement("div",{className:"content"},a.content),k["default"].createElement(l.Button,{onClick:b.confirmYes.bind(this),color:"primary",className:"mui--z1"},"是"),k["default"].createElement(l.Button,{onClick:b.confirmNo.bind(this)},"否")):null)}}]),b}(j.Component);b["default"]=(0,p.connect)(function(a){return{confirm:a.confirm}},function(a){return{actions:(0,o.bindActionCreators)(n,a)}})(q)},286:function(a,b,c){"use strict";function d(a){return a&&a.__esModule?a:{"default":a}}function e(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function f(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");
return!b||"object"!=typeof b&&"function"!=typeof b?a:b}function g(a,b){if("function"!=typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}Object.defineProperty(b,"__esModule",{value:!0});var h=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),i=c(143),j=d(i),k=(c(246),c(221)),l=(c(155),c(276)),m=c(273),n=d(m),o=c(287),p=d(o),q=c(288),r=d(q),s=function(a){function b(a){return e(this,b),f(this,Object.getPrototypeOf(b).call(this,a))}return g(b,a),h(b,[{key:"componentDidMount",value:function(){this.props.fetchUserAuthInfo(),this.props.fetchBookList("books")}},{key:"render",value:function(){return j["default"].createElement("div",{className:"page-book-store"},j["default"].createElement(n["default"],{user:this.props.user}),j["default"].createElement(r["default"],{bookList:this.props.bookList}),j["default"].createElement(p["default"],null))}}]),b}(i.Component);b["default"]=(0,k.connect)(function(a){return{bookList:a.book.bookList,user:a.user}},{fetchBookList:l.fetchBookList,fetchUserAuthInfo:l.fetchUserAuthInfo})(s)},287:function(a,b,c){"use strict";function d(a){return a&&a.__esModule?a:{"default":a}}function e(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function f(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!b||"object"!=typeof b&&"function"!=typeof b?a:b}function g(a,b){if("function"!=typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}Object.defineProperty(b,"__esModule",{value:!0});var h=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),i=c(143),j=d(i),k=(c(155),c(246)),l=function(a){function b(){return e(this,b),f(this,Object.getPrototypeOf(b).apply(this,arguments))}return g(b,a),h(b,[{key:"render",value:function(){return j["default"].createElement("div",{className:"colophon"},j["default"].createElement(k.Container,null,j["default"].createElement("p",null,"© 2015－2016 readrweb.com, all rights reserved")))}}]),b}(i.Component);b["default"]=l},288:function(a,b,c){"use strict";function d(a){return a&&a.__esModule?a:{"default":a}}function e(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function f(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!b||"object"!=typeof b&&"function"!=typeof b?a:b}function g(a,b){if("function"!=typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}Object.defineProperty(b,"__esModule",{value:!0});var h=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),i=c(143),j=d(i),k=c(246),l=(c(155),c(289)),m=d(l),n=function(a){function b(){return e(this,b),f(this,Object.getPrototypeOf(b).apply(this,arguments))}return g(b,a),h(b,[{key:"render",value:function(){var a=this.props.bookList;return j["default"].createElement(k.Container,null,j["default"].createElement("div",{className:"book-box"},j["default"].createElement("h1",{className:"page-title"},"新书速递"),j["default"].createElement("ul",{className:"book-list clearfix"},a?a.map(function(a,b){return j["default"].createElement(m["default"],{id:a.id,key:b,book:a})}):null)))}}]),b}(i.Component);b["default"]=n},289:function(a,b,c){"use strict";function d(a){return a&&a.__esModule?a:{"default":a}}function e(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function f(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!b||"object"!=typeof b&&"function"!=typeof b?a:b}function g(a,b){if("function"!=typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}Object.defineProperty(b,"__esModule",{value:!0});var h=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),i=c(143),j=d(i),k=(c(246),c(155)),l=function(a){function b(){return e(this,b),f(this,Object.getPrototypeOf(b).apply(this,arguments))}return g(b,a),h(b,[{key:"render",value:function(){var a=this.props.book;return j["default"].createElement("li",{className:"book"},j["default"].createElement(k.Link,{to:"/bookstore/book/"+this.props.id},j["default"].createElement("div",{className:"book-cover"},j["default"].createElement("img",{src:a.image})),j["default"].createElement("div",{className:"book-meta"},j["default"].createElement("span",{title:a.title,className:"book-name"},a.title),j["default"].createElement("span",{className:"book-author"},Array.isArray(a.author)?a.author.join(" "):a.author))))}}]),b}(i.Component);b["default"]=l},290:function(a,b,c){"use strict";function d(a){return a&&a.__esModule?a:{"default":a}}function e(a,b,c){return b in a?Object.defineProperty(a,b,{value:c,enumerable:!0,configurable:!0,writable:!0}):a[b]=c,a}function f(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function g(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!b||"object"!=typeof b&&"function"!=typeof b?a:b}function h(a,b){if("function"!=typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}Object.defineProperty(b,"__esModule",{value:!0});var i=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),j=c(143),k=d(j),l=c(221),m=c(246),n=c(155),o=c(215),p=c(213),q=c(276),r=c(291),s=d(r),t=c(273),u=d(t),v=function(a){function b(a){f(this,b);var c=g(this,Object.getPrototypeOf(b).call(this,a));return c.state={login:"",password:""},c}return h(b,a),i(b,[{key:"handleSignin",value:function(a){var b=this;a.preventDefault();var c={login:this.state.login,password:this.state.password};(0,p.callApi)(o.API_ROOT+"auth","POST",c).then(function(a){b.props.handleNotification("登录成功！"),setTimeout(function(){n.browserHistory.push("/")},600)})["catch"](function(a){b.props.handleNotification(a.message)})}},{key:"handleInput",value:function(a){this.setState(e({},a.target.name,a.target.value))}},{key:"render",value:function(){return k["default"].createElement("div",{className:"page-signin"},k["default"].createElement(u["default"],{user:this.props.user}),k["default"].createElement(m.Container,null,k["default"].createElement(m.Form,{className:"content-container",action:o.API_ROOT+"auth",method:"post"},k["default"].createElement(s["default"],{notification:this.props.notification}),k["default"].createElement("h1",{className:"page-title"},"欢迎回来"),k["default"].createElement(m.Input,{onChange:this.handleInput.bind(this),value:this.state.login,name:"login",hint:"用户名或邮箱"}),k["default"].createElement(m.Input,{onChange:this.handleInput.bind(this),value:this.state.password,name:"password",hint:"密码",type:"password"}),k["default"].createElement(m.Button,{onClick:this.handleSignin.bind(this),variant:"raised"},"登录"),k["default"].createElement("p",{className:"hint"},"没有账号？",k["default"].createElement(n.Link,{to:"/signup"},"注册")))))}}]),b}(j.Component);b["default"]=(0,l.connect)(function(a){return{notification:a.notification,user:a.user}},{handleNotification:q.handleNotification,fetchUserAuthInfo:q.fetchUserAuthInfo})(v)},291:function(a,b,c){"use strict";function d(a){return a&&a.__esModule?a:{"default":a}}function e(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function f(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!b||"object"!=typeof b&&"function"!=typeof b?a:b}function g(a,b){if("function"!=typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}Object.defineProperty(b,"__esModule",{value:!0});var h=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),i=c(143),j=d(i),k=function(a){function b(){return e(this,b),f(this,Object.getPrototypeOf(b).apply(this,arguments))}return g(b,a),h(b,[{key:"render",value:function(){var a=this.props.notification;return j["default"].createElement("div",null,a.isVisible?j["default"].createElement("div",{className:"msg mui--z1"},a.content):null)}}]),b}(i.Component);b["default"]=k},292:function(a,b,c){"use strict";function d(a){return a&&a.__esModule?a:{"default":a}}function e(a,b,c){return b in a?Object.defineProperty(a,b,{value:c,enumerable:!0,configurable:!0,writable:!0}):a[b]=c,a}function f(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function g(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!b||"object"!=typeof b&&"function"!=typeof b?a:b}function h(a,b){if("function"!=typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}Object.defineProperty(b,"__esModule",{value:!0});var i=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),j=c(143),k=d(j),l=c(221),m=c(246),n=c(155),o=c(215),p=c(213),q=c(276),r=c(291),s=d(r),t=c(273),u=d(t),v=function(a){function b(a){f(this,b);var c=g(this,Object.getPrototypeOf(b).call(this,a));return c.state={username:"",email:"",password:""},c}return h(b,a),i(b,[{key:"handleSignup",value:function(a){var b=this;a.preventDefault();var c={username:this.state.username,email:this.state.email,password:this.state.password};(0,p.callApi)(o.API_ROOT+"users","POST",c).then(function(a){b.props.handleNotification("注册成功！"),setTimeout(function(){n.browserHistory.push("/")},600)})["catch"](function(a){b.props.handleNotification(a.message)})}},{key:"handleInput",value:function(a){this.setState(e({},a.target.name,a.target.value))}},{key:"render",value:function(){return k["default"].createElement("div",{className:"page-signup"},k["default"].createElement(u["default"],{user:this.props.user}),k["default"].createElement(m.Container,null,k["default"].createElement(m.Form,{className:"content-container",method:"post",action:"/signup"},k["default"].createElement(s["default"],{notification:this.props.notification}),k["default"].createElement("h1",{className:"page-title"},"加入 Readr"),k["default"].createElement(m.Input,{onChange:this.handleInput.bind(this),value:this.state.username,name:"username",hint:"用户名"}),k["default"].createElement(m.Input,{onChange:this.handleInput.bind(this),value:this.state.email,name:"email",hint:"邮箱"}),k["default"].createElement(m.Input,{onChange:this.handleInput.bind(this),value:this.state.password,name:"password",hint:"密码 ",type:"password"}),k["default"].createElement(m.Button,{onClick:this.handleSignup.bind(this),variant:"raised"},"注册"),k["default"].createElement("p",{className:"hint"},"没有账号？",k["default"].createElement(n.Link,{to:"/signin"},"登录")))))}}]),b}(j.Component);b["default"]=(0,l.connect)(function(a){return{notification:a.notification,user:a.user}},{handleNotification:q.handleNotification,fetchUserAuthInfo:q.fetchUserAuthInfo})(v)},293:function(a,b,c){"use strict";function d(a){return a&&a.__esModule?a:{"default":a}}function e(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function f(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!b||"object"!=typeof b&&"function"!=typeof b?a:b}function g(a,b){if("function"!=typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}Object.defineProperty(b,"__esModule",{value:!0});var h=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),i=c(143),j=d(i),k=c(2),l=d(k),m=c(221),n=(c(155),c(246)),o=c(215),p=c(276),q=c(213),r=c(273),s=d(r),t=c(287),u=d(t),v=c(291),w=d(v),x=function(a){function b(a){e(this,b);var c=f(this,Object.getPrototypeOf(b).call(this,a));return c.defaultState={searchQuery:"",currentBook:-1,previewIndex:-1,conformed:!1},c.state=c.defaultState,c}return g(b,a),h(b,[{key:"componentDidMount",value:function(){this.props.fetchUserAuthInfo()}},{key:"handleAddBook",value:function(a){var b=this;a.preventDefault();for(var c=this.state.currentBook,d={},e=l["default"].findDOMNode(this.refs.bookContent).childNodes[0].value,f=!1;;){if(-1===c){this.props.handleNotification("未选择书籍！");break}if(d.bookInfo=this.props.book.searchResults.books[c],!e){this.props.handleNotification("请输入书籍内容！");break}d.bookContent=e,f=!0;break}d.bookInfo=JSON.stringify(d.bookInfo),f&&(0,q.callApi)(o.API_ROOT+"books","post",d).then(function(a){b.props.handleNotification("添加成功")})["catch"](function(a){console.error(a),b.props.handleNotification(a.message)})}},{key:"search",value:function(a){this.setState({searchQuery:a.target.value}),this.props.fetchDoubanBookSearchResults("search?count=5&q="+a.target.value)}},{key:"conformResult",value:function(a){this.setState({currentBook:a,conformed:!0})}},{key:"showBookCover",value:function(a){this.setState({previewIndex:a})}},{key:"removeResult",value:function(){this.setState(this.defaultState),this.props.clearBookSearch()}},{key:"render",value:function(){var a=this,b=null;return-1!==this.state.currentBook&&(b=this.props.book.searchResults.books[this.state.currentBook]),j["default"].createElement("div",{className:"page-add-book"},j["default"].createElement(s["default"],{user:this.props.user}),j["default"].createElement(n.Container,null,j["default"].createElement(n.Form,{className:"content-container",method:"post"},j["default"].createElement(w["default"],{notification:this.props.notification}),j["default"].createElement("h1",{className:"page-title"},"添加书籍"),this.state.conformed?null:j["default"].createElement(n.Input,{onChange:this.search.bind(this),value:this.state.searchQuery,hint:"输入书名或其他书籍相关信息"}),!this.state.conformed&&this.props.book.searchResults?j["default"].createElement("div",{className:"drop-down"},j["default"].createElement("ul",null,this.props.book.searchResults.books.map(function(b,c){return j["default"].createElement("li",{onMouseOver:a.showBookCover.bind(a,c),onClick:a.conformResult.bind(a,c),key:c},b.title," (",b.author,")",a.state.previewIndex===c?j["default"].createElement("div",null,j["default"].createElement("img",{src:b.image})):null)}))):null,b?j["default"].createElement("div",{className:"book"},j["default"].createElement("div",null,j["default"].createElement("img",{src:b.image})),j["default"].createElement("h2",{className:"book-name"},b.title),j["default"].createElement("div",{className:"book-author"},"作者：",b.author[0]),j["default"].createElement(n.Button,{onClick:this.removeResult.bind(this),className:"mui--z1"},"重新选择")):null,j["default"].createElement(n.Textarea,{hint:"粘贴书籍的全部文本内容",style:{height:200},name:"book_content",ref:"bookContent"}),j["default"].createElement(n.Button,{onClick:this.handleAddBook.bind(this),variant:"raised"},"确认添加"))),j["default"].createElement(u["default"],null))}}]),b}(i.Component);b["default"]=(0,m.connect)(function(a){return{user:a.user,book:a.book,notification:a.notification}},{fetchUserAuthInfo:p.fetchUserAuthInfo,fetchDoubanBookSearchResults:p.fetchDoubanBookSearchResults,clearBookSearch:p.clearBookSearch,handleNotification:p.handleNotification})(x)},294:function(a,b,c){"use strict";function d(a){return a&&a.__esModule?a:{"default":a}}function e(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function f(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!b||"object"!=typeof b&&"function"!=typeof b?a:b}function g(a,b){if("function"!=typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}Object.defineProperty(b,"__esModule",{value:!0});var h=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),i=c(143),j=d(i),k=c(246),l=c(155),m=c(221),n=c(276),o=c(273),p=d(o),q=c(287),r=d(q),s=function(a){function b(a){e(this,b);var c=f(this,Object.getPrototypeOf(b).call(this,a));return c.bookId=a.params.id,c}return g(b,a),h(b,[{key:"componentDidMount",value:function(){this.props.fetchUserAuthInfo(),this.props.fetchBookInfo(this.bookId,"books/"+this.bookId).then(function(a){})["catch"](function(a){console.log(a)})}},{key:"render",value:function(){var a=this.props.bookInfo?this.props.bookInfo:{};return j["default"].createElement("div",{className:"page-book-info"},j["default"].createElement(p["default"],{user:this.props.user}),j["default"].createElement(k.Container,null,j["default"].createElement("article",{className:"book-info content-container"},j["default"].createElement("header",{className:"book-info-header"},j["default"].createElement("div",{className:"left-col"},a.image?j["default"].createElement("div",{className:"book-cover"},j["default"].createElement("img",{src:a.image})):null),j["default"].createElement("div",{className:"right-col"},j["default"].createElement("h1",{className:"book-name"},a.title),j["default"].createElement("div",{className:"book-author"},j["default"].createElement("strong",null,"作者：",a.author)),a.title?j["default"].createElement(l.Link,{to:"/book/"+a.id},j["default"].createElement(k.Button,{color:"primary"},"阅读")):null,j["default"].createElement("p",null,j["default"].createElement("a",{target:"_blank",href:"http://book.douban.com/subject/"+a.book_id},"在豆瓣查看")))),a.author_intro?j["default"].createElement("div",null,j["default"].createElement("h2",null,"作者简介"),j["default"].createElement("p",null,a.author_intro)):null,a.summary?j["default"].createElement("div",null,j["default"].createElement("h2",null,"内容简介"),j["default"].createElement("p",null,a.summary)):null)),j["default"].createElement(r["default"],null))}}]),b}(i.Component);b["default"]=(0,m.connect)(function(a){return{bookInfo:a.book.meta,user:a.user}},{fetchBookInfo:n.fetchBookInfo,fetchUserAuthInfo:n.fetchUserAuthInfo})(s)},295:function(a,b,c){"use strict";var d=c(213);(0,d.getEnv)();a.exports=c(296)},296:function(a,b,c){"use strict";function d(a){return a&&a.__esModule?a:{"default":a}}function e(a){return(0,f.createStore)(j["default"],a,(0,f.applyMiddleware)(h["default"],l["default"]))}Object.defineProperty(b,"__esModule",{value:!0}),b["default"]=e;var f=c(227),g=c(297),h=d(g),i=c(298),j=d(i),k=c(304),l=d(k)},298:function(a,b,c){"use strict";function d(a){return a&&a.__esModule?a:{"default":a}}Object.defineProperty(b,"__esModule",{value:!0});var e=c(227),f=c(299),g=d(f),h=c(300),i=d(h),j=c(301),k=d(j),l=c(302),m=d(l),n=c(303),o=d(n),p=(0,e.combineReducers)({book:g["default"],user:i["default"],notification:k["default"],view:o["default"],confirm:m["default"]});b["default"]=p},299:function(a,b){"use strict";function c(a,b){switch("undefined"==typeof a&&(a={}),b.type){case"BOOK_LIST_REQUEST":return Object.assign({},a,{isFetchingList:!0});case"BOOK_LIST_SUCCESS":return Object.assign({},a,{isFetchingList:!1,bookList:b.response});case"BOOK_CONTENT_REQUEST":return Object.assign({},a,{isFetchingContent:!0,id:b.bookId});case"BOOK_CONTENT_SUCCESS":return Object.assign({},a,{isFetchingContent:!1,html:b.response.html});case"BOOK_INFO_REQUEST":return Object.assign({},a,{isFetchingInfo:!0,id:b.bookId});case"BOOK_INFO_SUCCESS":return Object.assign({},a,{isFetchingInfo:!1,meta:b.response});case"LOAD_HTML":return Object.assign({},a,{html:b.html});case"LOAD_PAGES":return Object.assign({},a,{isPagesLoaded:!0,pages:b.pages});case"SET_BOOK_MODE":return Object.assign({},a,{mode:b.mode});case"JUMP_TO":return Object.assign({},a,{isPagesLoaded:!0,currentPage:b.currentPage});case"DOUBAN_BOOK_SEARCH_REQUEST":return Object.assign({},a,{isFetchingSearch:!0});case"DOUBAN_BOOK_SEARCH_SUCCESS":return Object.assign({},a,{isFetchingSearch:!1,searchResults:b.response});case"DOUBAN_BOOK_SEARCH_FAILURE":return Object.assign({},a,{isFetchingSearch:!1,error:b.response});case"CLEAR_BOOK_SEARCH":return Object.assign({},a,{searchResults:null});default:return a}}Object.defineProperty(b,"__esModule",{value:!0}),b["default"]=c},300:function(a,b){"use strict";function c(a,b){switch("undefined"==typeof a&&(a={}),b.type){case"USER_AUTH_INFO_REQUEST":return Object.assign({},a,{isFetchingUserAuthInfo:!0});case"USER_AUTH_INFO_SUCCESS":return Object.assign({},a,{isFetchingUserAuthInfo:!1,authed:b.response.authed,username:b.response.authed?b.response.user.username:"",role:b.response.authed?b.response.user.role:"visitor"});default:return a}}Object.defineProperty(b,"__esModule",{value:!0}),b["default"]=c},301:function(a,b){"use strict";function c(a,b){switch("undefined"==typeof a&&(a={}),b.type){case"SHOW_NOTIFICATION":return Object.assign({},a,{content:b.content,isVisible:!0});case"HIDE_NOTIFICATION":return Object.assign({},a,{isVisible:!1});default:return a}}Object.defineProperty(b,"__esModule",{value:!0}),b["default"]=c},302:function(a,b){"use strict";function c(a,b){switch("undefined"==typeof a&&(a={isVisible:!1,result:"unsettled"}),b.type){case"SHOW_CONFIRM":return Object.assign({},a,{content:b.content,isVisible:!0});case"HIDE_CONFIRM":return Object.assign({},a,{isVisible:!1});case"CONFIRM_YES":return Object.assign({},a,{isVisible:!1,result:"yes"});case"CONFIRM_NO":return Object.assign({},a,{isVisible:!1,result:"no"});default:return a}}Object.defineProperty(b,"__esModule",{value:!0}),b["default"]=c},303:function(a,b){"use strict";function c(a,b){switch("undefined"==typeof a&&(a={screen:"hd",pageHeight:900,pageWidth:900}),b.type){case"SET_VIEW":return Object.assign({},a,b.view);default:return a}}Object.defineProperty(b,"__esModule",{value:!0}),b["default"]=c},304:function(a,b,c){"use strict";Object.defineProperty(b,"__esModule",{value:!0});var d=function(){function a(a,b){var c=[],d=!0,e=!1,f=void 0;try{for(var g,h=a[Symbol.iterator]();!(d=(g=h.next()).done)&&(c.push(g.value),!b||c.length!==b);d=!0);}catch(i){e=!0,f=i}finally{try{!d&&h["return"]&&h["return"]()}finally{if(e)throw f}}return c}return function(b,c){if(Array.isArray(b))return b;if(Symbol.iterator in Object(b))return a(b,c);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),e=c(213),f=c(215);b["default"]=function(a){return function(b){return function(c){function g(a){var b=Object.assign({},c,a);return delete b.CALL_API,b}var h=c.CALL_API;if("undefined"==typeof h)return b(c);var i=h.endpoint,j=h.apiUrl,k=h.types,l=d(k,3),m=l[0],n=l[1],o=l[2];b(g({type:m})),"function"==typeof i&&(i=i(a.getState())),"undefined"==typeof j&&(j=f.API_ROOT);var p=j+i;return(0,e.callApi)(p).then(function(a){return b(g({response:a,type:n}))},function(a){return b(g({type:o,error:a.message||"Oops!"}))})}}}}});